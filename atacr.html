

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ATaCR &mdash; Home 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Licence" href="obstools.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Home
          

          
            
            <img src="_static/obstools_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Quick Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="links.html">GitHub Repositories</a></li>
<li class="toctree-l1"><a class="reference internal" href="links.html#references">References</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="obstools.html">Licence</a></li>
<li class="toctree-l1"><a class="reference internal" href="obstools.html#installation">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">ATaCR</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#noise-corrections">Noise Corrections</a></li>
<li class="toctree-l2"><a class="reference internal" href="#api-documentation">API documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#base-classes">Base Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#daynoise">DayNoise</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stanoise">StaNoise</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tfnoise">TFNoise</a></li>
<li class="toctree-l4"><a class="reference internal" href="#eventstream">EventStream</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#container-classes">Container Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#power">Power</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cross">Cross</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rotation">Rotation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-obstools.atacr.utils">Utility functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-obstools.atacr.plot">Plotting functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#scripts">Scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#atacr-download-data-py"><code class="docutils literal notranslate"><span class="pre">atacr_download_data.py</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#atacr-daily-spectra-py"><code class="docutils literal notranslate"><span class="pre">atacr_daily_spectra.py</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#atacr-clean-spectra-py"><code class="docutils literal notranslate"><span class="pre">atacr_clean_spectra.py</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#atacr-transfer-functions-py"><code class="docutils literal notranslate"><span class="pre">atacr_transfer</span> <span class="pre">functions.py</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#atacr-download-event-py"><code class="docutils literal notranslate"><span class="pre">atacr_download_event.py</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#atacr-correct-event-py"><code class="docutils literal notranslate"><span class="pre">atacr_correct_event.py</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id10">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">Usage</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tutorial">Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-stdb-database">0. Creating the <code class="docutils literal notranslate"><span class="pre">StDb</span></code> Database</a></li>
<li class="toctree-l3"><a class="reference internal" href="#download-noise-data">1. Download noise data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#qc-for-daily-spectral-averages">2. QC for daily spectral averages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#qc-for-clean-station-averages">3. QC for clean station averages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transfer-function-calculation">4. Transfer function calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#download-earthquake-data">5. Download earthquake data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#correct-clean-earthquake-data">6. Correct/clean earthquake data</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Home</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>ATaCR</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/atacr.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="atacr">
<h1>ATaCR<a class="headerlink" href="#atacr" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">atacr</span></code> is a module for the correction of vertical component data from OBS
stations from tilt and compliance noise. This module is a translation of the
Matlab code <a class="reference external" href="https://github.com/helenjanisz/ATaCR">ATaCR</a> and the acronym
stands for Automatic Tilt and Compliance Removal. For more details on the
theory and methodology, we refer the interested reader to the following papers:</p>
<ul class="simple">
<li><p>Bell, S. W., D. W. Forsyth, and Y. Ruan (2014), Removing noise from the
vertical component records of ocean-bottom seismometers: Results from year one of the
Cascadia Initiative, Bull. Seismol. Soc. Am., 105, 300-313,
<a class="reference external" href="https://doi.org/10.1785/0120140054">https://doi.org/10.1785/0120140054</a></p></li>
<li><p>Crawford, W.C., Webb, S.C., (2000). Identifying and removing tilt noise from
low-frequency (0.1 Hz) seafloor vertical seismic data, Bull. seism. Soc. Am., 90, 952-963,
<a class="reference external" href="https://doi.org/10.1785/0119990121">https://doi.org/10.1785/0119990121</a></p></li>
<li><p>Janiszewski, H A, J B Gaherty, G A Abers, H Gao, Z C Eilon, Amphibious surface-wave
phase-velocity measurements of the Cascadia subduction zone, Geophysical Journal
International, Volume 217, Issue 3, June 2019, Pages 1929-1948, <a class="reference external" href="https://doi.org/10.1093/gji/ggz051">https://doi.org/10.1093/gji/ggz051</a></p></li>
</ul>
<p>The analysis can be carried out for either one (or both) compliance or tilt
corrections. In all cases the analysis requires at least vertical component
data. Additional data required depend on the type of analysis. The software
will automatically calculate all possible corrections depending on the available
channels.</p>
</div>
<div class="section" id="noise-corrections">
<h2>Noise Corrections<a class="headerlink" href="#noise-corrections" title="Permalink to this headline">¶</a></h2>
<p><strong>Compliance</strong></p>
<p>Compliance is defined as the spectral ratio between pressure and vertical
displacement data. Compliance noise arises from seafloor deformation due
to seafloor and water wave effects (including infragravity waves).
This is likely the main source of noise in vertical component OBS data.
This analysis therefore requires both vertical (<code class="docutils literal notranslate"><span class="pre">?HZ</span></code>) and pressure (<code class="docutils literal notranslate"><span class="pre">?XH</span></code>) data.</p>
<p><strong>Tilt</strong></p>
<p>Tilt noise arises from OBS stations that are not perfectly leveled, and
therefore the horizontal seafloor deformation leaks onto the vertical
component. This effect can be removed by calculating the spectral
ratio between horizontal and vertical displacement data. In most cases,
however, the tilt direction (measured on a compass - as opposed to tilt
angle, measured from the vertical axis) is unknown and must be determined
from the coherence between rotated horizontal components and the vertical
component. This analysis therefore requires vertical (<code class="docutils literal notranslate"><span class="pre">?HZ</span></code>) and the two
horizontal (<code class="docutils literal notranslate"><span class="pre">?H1,2</span></code>) component data.</p>
<p><strong>Compliance + Tilt</strong></p>
<p>It is of course possible to combine both corrections and apply them
sequentially. In this case the tilt noise is removed first, followed by compliance.
This analysis requires all four components: three-component
seismic (<code class="docutils literal notranslate"><span class="pre">?HZ,1,2</span></code>) and pressure (<code class="docutils literal notranslate"><span class="pre">?XH</span></code>) data.</p>
</div>
<div class="section" id="api-documentation">
<h2>API documentation<a class="headerlink" href="#api-documentation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="base-classes">
<h3>Base Classes<a class="headerlink" href="#base-classes" title="Permalink to this headline">¶</a></h3>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">atacr</span></code> defines the following base classes:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#obstools.atacr.classes.DayNoise" title="obstools.atacr.classes.DayNoise"><code class="xref py py-class docutils literal notranslate"><span class="pre">DayNoise</span></code></a></p></li>
<li><p><a class="reference internal" href="#obstools.atacr.classes.StaNoise" title="obstools.atacr.classes.StaNoise"><code class="xref py py-class docutils literal notranslate"><span class="pre">StaNoise</span></code></a></p></li>
<li><p><a class="reference internal" href="#obstools.atacr.classes.TFNoise" title="obstools.atacr.classes.TFNoise"><code class="xref py py-class docutils literal notranslate"><span class="pre">TFNoise</span></code></a></p></li>
<li><p><a class="reference internal" href="#obstools.atacr.classes.EventStream" title="obstools.atacr.classes.EventStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">EventStream</span></code></a></p></li>
</ul>
<p>The class <a class="reference internal" href="#obstools.atacr.classes.DayNoise" title="obstools.atacr.classes.DayNoise"><code class="xref py py-class docutils literal notranslate"><span class="pre">DayNoise</span></code></a> contains attributes
and methods for the analysis of two- to four-component day-long time-series
(3-component seismograms and pressure data). Objects created with this class
are required in any subsequent analysis. The available methods calculate the
power-spectral density (PSD) functions of sub-windows (default is 2-hour windows)
and identifies windows with anomalous PSD properties. These windows are flagged
and are excluded from the final averages of all possible PSD and cross-spectral density
functions between all available components.</p>
<p>The class <a class="reference internal" href="#obstools.atacr.classes.StaNoise" title="obstools.atacr.classes.StaNoise"><code class="xref py py-class docutils literal notranslate"><span class="pre">StaNoise</span></code></a> contains attributes
and methods for the aggregation of averaged daily spectra into a station
average. An object created with this class requires that at least two
<cite>DayNoise</cite> objects are available in memory. Methods available for this class are
similar to those defined in the <cite>DayNoise</cite> class, but are applied to daily
spectral averages, as opposed to sub-daily averages. The result is a spectral
average that represents all available data for the specific station.</p>
<p>The class <a class="reference internal" href="#obstools.atacr.classes.TFNoise" title="obstools.atacr.classes.TFNoise"><code class="xref py py-class docutils literal notranslate"><span class="pre">TFNoise</span></code></a> contains attributes
and methods for the calculation of transfer functions from noise
traces used to correct the vertical component. A <cite>TFNoise</cite> object works with
either one of <cite>DayNoise</cite> and <cite>StaNoise</cite> objects to calculate all possible
transfer functions across all available components. These transfer functions
are saved as attributes of the object in a Dictionary.</p>
<p>The class <a class="reference internal" href="#obstools.atacr.classes.EventStream" title="obstools.atacr.classes.EventStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">EventStream</span></code></a> contains attributes
and methods for the application of the transfer functions to the
event traces for the correction (cleaning) of vertical component
seismograms. An <cite>EventStream</cite> object is initialized with raw (or pre-processed)
seismic and/or pressure data and needs to be processed using the same (sub) window
properties as the <cite>DayNoise</cite> objects. This ensures that the component corrections
are safely applied to produce corrected (cleaned) vertical components.</p>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">atacr</span></code> further defines the following container classes:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#obstools.atacr.classes.Power" title="obstools.atacr.classes.Power"><code class="xref py py-class docutils literal notranslate"><span class="pre">Power</span></code></a></p></li>
<li><p><a class="reference internal" href="#obstools.atacr.classes.Cross" title="obstools.atacr.classes.Cross"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cross</span></code></a></p></li>
<li><p><a class="reference internal" href="#obstools.atacr.classes.Rotation" title="obstools.atacr.classes.Rotation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rotation</span></code></a></p></li>
</ul>
<p>These classes are used as containers for individual traces/objects
that are used as attributes of the base classes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the examples below, the SAC data were obtained and pre-processed
using the accompanying scripts <code class="docutils literal notranslate"><span class="pre">atacr_download_data.py</span></code> and
<code class="docutils literal notranslate"><span class="pre">atacr_download_event.py</span></code>. See the script and tutorial for details.</p>
</div>
<div class="section" id="daynoise">
<h4>DayNoise<a class="headerlink" href="#daynoise" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="obstools.atacr.classes.DayNoise">
<em class="property">class </em><code class="sig-prename descclassname">obstools.atacr.classes.</code><code class="sig-name descname">DayNoise</code><span class="sig-paren">(</span><em class="sig-param">tr1=None</em>, <em class="sig-param">tr2=None</em>, <em class="sig-param">trZ=None</em>, <em class="sig-param">trP=None</em>, <em class="sig-param">window=7200.0</em>, <em class="sig-param">overlap=0.3</em>, <em class="sig-param">key=''</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.DayNoise" title="Permalink to this definition">¶</a></dt>
<dd><p>A DayNoise object contains attributes that associate
three-component raw (or deconvolved) traces, metadata information
and window parameters. The available methods carry out the quality
control steps and the average daily spectra for windows flagged as
“good”.</p>
<p class="rubric">Notes</p>
<p>The object is initialized with <code class="xref py py-class docutils literal notranslate"><span class="pre">Trace</span></code> objects for
H1, H2, HZ and P components. Traces can be empty if data are not
available. Upon saving, those traces are discarded to save disk space.</p>
<dl class="attribute">
<dt id="obstools.atacr.classes.DayNoise.window">
<code class="sig-name descname">window</code><a class="headerlink" href="#obstools.atacr.classes.DayNoise.window" title="Permalink to this definition">¶</a></dt>
<dd><p>Length of time window in seconds</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.DayNoise.overlap">
<code class="sig-name descname">overlap</code><a class="headerlink" href="#obstools.atacr.classes.DayNoise.overlap" title="Permalink to this definition">¶</a></dt>
<dd><p>Fraction of overlap between adjacent windows</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.DayNoise.key">
<code class="sig-name descname">key</code><a class="headerlink" href="#obstools.atacr.classes.DayNoise.key" title="Permalink to this definition">¶</a></dt>
<dd><p>Station key for current object</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.DayNoise.dt">
<code class="sig-name descname">dt</code><a class="headerlink" href="#obstools.atacr.classes.DayNoise.dt" title="Permalink to this definition">¶</a></dt>
<dd><p>Sampling distance in seconds. Obtained from <code class="docutils literal notranslate"><span class="pre">trZ</span></code> object</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.DayNoise.npts">
<code class="sig-name descname">npts</code><a class="headerlink" href="#obstools.atacr.classes.DayNoise.npts" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of points in time series. Obtained from <code class="docutils literal notranslate"><span class="pre">trZ</span></code> object</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.DayNoise.fs">
<code class="sig-name descname">fs</code><a class="headerlink" href="#obstools.atacr.classes.DayNoise.fs" title="Permalink to this definition">¶</a></dt>
<dd><p>Sampling frequency (in Hz). Obtained from <code class="docutils literal notranslate"><span class="pre">trZ</span></code> object</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.DayNoise.year">
<code class="sig-name descname">year</code><a class="headerlink" href="#obstools.atacr.classes.DayNoise.year" title="Permalink to this definition">¶</a></dt>
<dd><p>Year for current object (obtained from UTCDateTime). Obtained from
<code class="docutils literal notranslate"><span class="pre">trZ</span></code> object</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.DayNoise.julday">
<code class="sig-name descname">julday</code><a class="headerlink" href="#obstools.atacr.classes.DayNoise.julday" title="Permalink to this definition">¶</a></dt>
<dd><p>Julian day for current object (obtained from UTCDateTime). Obtained
from <code class="docutils literal notranslate"><span class="pre">trZ</span></code> object</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.DayNoise.ncomp">
<code class="sig-name descname">ncomp</code><a class="headerlink" href="#obstools.atacr.classes.DayNoise.ncomp" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of available components (either 2, 3 or 4). Obtained from
non-empty <code class="docutils literal notranslate"><span class="pre">Trace</span></code> objects</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.DayNoise.tf_list">
<code class="sig-name descname">tf_list</code><a class="headerlink" href="#obstools.atacr.classes.DayNoise.tf_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of possible transfer functions given the available
components.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>Dict</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.DayNoise.goodwins">
<code class="sig-name descname">goodwins</code><a class="headerlink" href="#obstools.atacr.classes.DayNoise.goodwins" title="Permalink to this definition">¶</a></dt>
<dd><p>List of booleans representing whether a window is good (True) or
not (False).
This attribute is returned from the method
<a class="reference internal" href="#obstools.atacr.classes.DayNoise.QC_daily_spectra" title="obstools.atacr.classes.DayNoise.QC_daily_spectra"><code class="xref py py-func docutils literal notranslate"><span class="pre">QC_daily_spectra()</span></code></a></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.DayNoise.power">
<code class="sig-name descname">power</code><a class="headerlink" href="#obstools.atacr.classes.DayNoise.power" title="Permalink to this definition">¶</a></dt>
<dd><p>Container for daily spectral power for all available components</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#obstools.atacr.classes.Power" title="obstools.atacr.classes.Power"><code class="xref py py-class docutils literal notranslate"><span class="pre">Power</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.DayNoise.cross">
<code class="sig-name descname">cross</code><a class="headerlink" href="#obstools.atacr.classes.DayNoise.cross" title="Permalink to this definition">¶</a></dt>
<dd><p>Container for daily cross spectral power for all available components</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#obstools.atacr.classes.Cross" title="obstools.atacr.classes.Cross"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cross</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.DayNoise.rotation">
<code class="sig-name descname">rotation</code><a class="headerlink" href="#obstools.atacr.classes.DayNoise.rotation" title="Permalink to this definition">¶</a></dt>
<dd><p>Container for daily rotated (cross) spectral power for all available
components</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#obstools.atacr.classes.Rotation" title="obstools.atacr.classes.Rotation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Rotation</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.DayNoise.f">
<code class="sig-name descname">f</code><a class="headerlink" href="#obstools.atacr.classes.DayNoise.f" title="Permalink to this definition">¶</a></dt>
<dd><p>Frequency axis for corresponding time sampling parameters. Determined
from method
<a class="reference internal" href="#obstools.atacr.classes.DayNoise.average_daily_spectra" title="obstools.atacr.classes.DayNoise.average_daily_spectra"><code class="xref py py-func docutils literal notranslate"><span class="pre">average_daily_spectra()</span></code></a></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<p class="rubric">Examples</p>
<p>Get demo noise data as DayNoise object</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">DayNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span> <span class="o">=</span> <span class="n">DayNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 04, 2012, station 7D.M08A</span>
</pre></div>
</div>
<p>Now check its main attributes</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">daynoise</span><span class="o">.</span><span class="n">tr1</span><span class="p">,</span> <span class="n">daynoise</span><span class="o">.</span><span class="n">tr2</span><span class="p">,</span> <span class="n">daynoise</span><span class="o">.</span><span class="n">trZ</span><span class="p">,</span> <span class="n">daynoise</span><span class="o">.</span><span class="n">trP</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">7D.M08A..1 | 2012-03-04T00:00:00.005500Z - 2012-03-04T23:59:59.805500Z | 5.0 Hz, 432000 samples</span>
<span class="go">7D.M08A..2 | 2012-03-04T00:00:00.005500Z - 2012-03-04T23:59:59.805500Z | 5.0 Hz, 432000 samples</span>
<span class="go">7D.M08A..P | 2012-03-04T00:00:00.005500Z - 2012-03-04T23:59:59.805500Z | 5.0 Hz, 432000 samples</span>
<span class="go">7D.M08A..Z | 2012-03-04T00:00:00.005500Z - 2012-03-04T23:59:59.805500Z | 5.0 Hz, 432000 samples</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">window</span>
<span class="go">7200.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">overlap</span>
<span class="go">0.3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">key</span>
<span class="go">&#39;7D.M08A&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">ncomp</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">tf_list</span>
<span class="go">{&#39;ZP&#39;: True, &#39;Z1&#39;: True, &#39;Z2-1&#39;: True, &#39;ZP-21&#39;: True, &#39;ZH&#39;: True, &#39;ZP-H&#39;: True}</span>
</pre></div>
</div>
<dl class="method">
<dt id="obstools.atacr.classes.DayNoise.QC_daily_spectra">
<code class="sig-name descname">QC_daily_spectra</code><span class="sig-paren">(</span><em class="sig-param">pd=[0.004, 0.2], tol=1.5, alpha=0.05, smooth=True, fig_QC=False, debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.DayNoise.QC_daily_spectra" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to determine daily time windows for which the spectra are
anomalous and should be discarded in the calculation of the
transfer functions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pd</strong> (<em>list</em>) – Frequency corners of passband for calculating the spectra</p></li>
<li><p><strong>tol</strong> (<em>float</em>) – Tolerance threshold. If spectrum &gt; std*tol, window is flagged as
bad</p></li>
<li><p><strong>alpha</strong> (<em>float</em>) – Confidence interval for f-test</p></li>
<li><p><strong>smooth</strong> (<em>boolean</em>) – Determines if the smoothed (True) or raw (False) spectra are used</p></li>
<li><p><strong>fig_QC</strong> (<em>boolean</em>) – Whether or not to produce a figure showing the results of the
quality control</p></li>
<li><p><strong>debug</strong> (<em>boolean</em>) – Whether or not to plot intermediate steps in the QC procedure
for debugging</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt>
<code class="sig-name descname">goodwins</code></dt>
<dd><p>List of booleans representing whether a window is good (True)
or not (False)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<p class="rubric">Examples</p>
<p>Perform QC on DayNoise object using default values and plot final
figure</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">DayNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span> <span class="o">=</span> <span class="n">DayNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">QC_daily_spectra</span><span class="p">(</span><span class="n">fig_QC</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="_images/Figure_3a.png" src="_images/Figure_3a.png" />
</div>
<p>Print out new attribute of DayNoise object</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">goodwins</span>
<span class="go">array([False,  True,  True,  True,  True,  True,  True,  True, False,</span>
<span class="go">   False,  True,  True,  True,  True,  True,  True], dtype=bool)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="obstools.atacr.classes.DayNoise.average_daily_spectra">
<code class="sig-name descname">average_daily_spectra</code><span class="sig-paren">(</span><em class="sig-param">calc_rotation=True</em>, <em class="sig-param">fig_average=False</em>, <em class="sig-param">fig_coh_ph=False</em>, <em class="sig-param">debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.DayNoise.average_daily_spectra" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to average the daily spectra for good windows. By default, the
method will attempt to calculate the azimuth of maximum coherence
between horizontal components and the vertical component (for maximum
tilt direction), and use the rotated horizontals in the transfer
function calculations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>calc_rotation</strong> (<em>boolean</em>) – Whether or not to calculate the tilt direction</p></li>
<li><p><strong>fig_average</strong> (<em>boolean</em>) – Whether or not to produce a figure showing the average daily
spectra</p></li>
<li><p><strong>fig_coh_ph</strong> (<em>boolean</em>) – Whether or not to produce a figure showing the maximum coherence
between H and Z</p></li>
<li><p><strong>debug</strong> (<em>boolean</em>) – Whether or not to plot intermediate steps in the QC procedure for
debugging</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt>
<code class="sig-name descname">f</code></dt>
<dd><p>Positive frequency axis for corresponding window parameters</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">power</code></dt>
<dd><p>Container for the Power spectra</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#obstools.atacr.classes.Power" title="obstools.atacr.classes.Power"><code class="xref py py-class docutils literal notranslate"><span class="pre">Power</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">cross</code></dt>
<dd><p>Container for the Cross power spectra</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#obstools.atacr.classes.Cross" title="obstools.atacr.classes.Cross"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cross</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">rotation</code></dt>
<dd><p>Container for the Rotated power and cross spectra</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#obstools.atacr.classes.Cross" title="obstools.atacr.classes.Cross"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cross</span></code></a>, optional</p>
</dd>
</dl>
</dd></dl>

<p class="rubric">Examples</p>
<p>Average spectra for good windows using default values and plot final
figure</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">DayNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span> <span class="o">=</span> <span class="n">DayNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">QC_daily_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">average_daily_spectra</span><span class="p">(</span><span class="n">fig_average</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="_images/Figure_3b.png" src="_images/Figure_3b.png" />
</div>
<p>Print out available attributes of DayNoise object</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">dict_keys([&#39;tr1&#39;, &#39;tr2&#39;, &#39;trZ&#39;, &#39;trP&#39;, &#39;window&#39;, &#39;overlap&#39;, &#39;key&#39;,</span>
<span class="go">&#39;dt&#39;, &#39;npts&#39;, &#39;fs&#39;, &#39;year&#39;, &#39;julday&#39;, &#39;ncomp&#39;, &#39;tf_list&#39;, &#39;QC&#39;, &#39;av&#39;,</span>
<span class="go">&#39;goodwins&#39;, &#39;f&#39;, &#39;power&#39;, &#39;cross&#39;, &#39;rotation&#39;])</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="obstools.atacr.classes.DayNoise.save">
<code class="sig-name descname">save</code><span class="sig-paren">(</span><em class="sig-param">filename</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.DayNoise.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to save the object to file using <cite>~Pickle</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – File name</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Run demo through all methods</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">DayNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span> <span class="o">=</span> <span class="n">DayNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">QC_daily_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">average_daily_spectra</span><span class="p">()</span>
</pre></div>
</div>
<p>Save object</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;daynoise_demo.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Check that it has been saved</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">glob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;./daynoise_demo.pkl&quot;</span><span class="p">)</span>
<span class="go">[&#39;./daynoise_demo.pkl&#39;]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="stanoise">
<h4>StaNoise<a class="headerlink" href="#stanoise" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="obstools.atacr.classes.StaNoise">
<em class="property">class </em><code class="sig-prename descclassname">obstools.atacr.classes.</code><code class="sig-name descname">StaNoise</code><span class="sig-paren">(</span><em class="sig-param">daylist=None</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.StaNoise" title="Permalink to this definition">¶</a></dt>
<dd><p>A StaNoise object contains attributes that associate
three-component raw (or deconvolved) traces, metadata information
and window parameters.</p>
<p class="rubric">Notes</p>
<p>The object is initially a container for
<a class="reference internal" href="#obstools.atacr.classes.DayNoise" title="obstools.atacr.classes.DayNoise"><code class="xref py py-class docutils literal notranslate"><span class="pre">DayNoise</span></code></a> objects. Once the StaNoise
object is initialized (using the method <cite>init()</cite> or by calling the
<cite>QC_sta_spectra</cite> method), each individual spectral quantity is unpacked
as an object attribute and the original <cite>DayNoise</cite> objects are removed
from memory. In addition, all spectral quantities associated with the
original <cite>DayNoise</cite> objects (now stored as attributes) are discarded as
the object is saved to disk and new container objects are defined and
saved.</p>
<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.daylist">
<code class="sig-name descname">daylist</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.daylist" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of <a class="reference internal" href="#obstools.atacr.classes.DayNoise" title="obstools.atacr.classes.DayNoise"><code class="xref py py-class docutils literal notranslate"><span class="pre">DayNoise</span></code></a> objects to process
and produce a station average</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.initialized">
<code class="sig-name descname">initialized</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.initialized" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether or not the object has been initialized - <cite>False</cite> unless one
of the methods have been called. When <cite>True</cite>, the <cite>daylist</cite> attribute
is deleted from memory</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<p class="rubric">Examples</p>
<p>Initialize empty object</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">StaNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span> <span class="o">=</span> <span class="n">StaNoise</span><span class="p">()</span>
</pre></div>
</div>
<p>Initialize with DayNoise object</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">DayNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span> <span class="o">=</span> <span class="n">DayNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span> <span class="o">=</span> <span class="n">StaNoise</span><span class="p">(</span><span class="n">daylist</span><span class="o">=</span><span class="p">[</span><span class="n">daynoise</span><span class="p">])</span>
</pre></div>
</div>
<p>Add or append DayNoise object to StaNoise</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span> <span class="o">=</span> <span class="n">StaNoise</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span> <span class="o">+=</span> <span class="n">daynoise</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span> <span class="o">=</span> <span class="n">StaNoise</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">daynoise</span><span class="p">)</span>
</pre></div>
</div>
<p>Import demo noise data with 4 DayNoise objects</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">StaNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span> <span class="o">=</span> <span class="n">StaNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 01 to 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">daylist</span>
<span class="go">[&lt;obstools.atacr.classes.DayNoise at 0x11e3ce8d0&gt;,</span>
<span class="go"> &lt;obstools.atacr.classes.DayNoise at 0x121c7ae10&gt;,</span>
<span class="go"> &lt;obstools.atacr.classes.DayNoise at 0x121ca5940&gt;,</span>
<span class="go"> &lt;obstools.atacr.classes.DayNoise at 0x121e7dd30&gt;]</span>
<span class="go"> &gt;&gt;&gt; sta.initialized</span>
<span class="go"> False</span>
</pre></div>
</div>
<dl class="method">
<dt id="obstools.atacr.classes.StaNoise.init">
<code class="sig-name descname">init</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.StaNoise.init" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to initialize the <cite>StaNoise</cite> object. This method is used to
unpack the spectral quantities from the original
<a class="reference internal" href="#obstools.atacr.classes.DayNoise" title="obstools.atacr.classes.DayNoise"><code class="xref py py-class docutils literal notranslate"><span class="pre">DayNoise</span></code></a> objects and allow the
methods to proceed. The original
<a class="reference internal" href="#obstools.atacr.classes.DayNoise" title="obstools.atacr.classes.DayNoise"><code class="xref py py-class docutils literal notranslate"><span class="pre">DayNoise</span></code></a> objects are deleted from
memory during this process.</p>
<p class="rubric">Notes</p>
<p>If the original <a class="reference internal" href="#obstools.atacr.classes.DayNoise" title="obstools.atacr.classes.DayNoise"><code class="xref py py-class docutils literal notranslate"><span class="pre">DayNoise</span></code></a> objects
have not been processed using their QC and averaging methods, these
will be called first before unpacking into the object attributes.</p>
<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.f">
<code class="sig-name descname">f</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.f" title="Permalink to this definition">¶</a></dt>
<dd><p>Frequency axis for corresponding time sampling parameters</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.nwins">
<code class="sig-name descname">nwins</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.nwins" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of good windows from the
<a class="reference internal" href="#obstools.atacr.classes.DayNoise" title="obstools.atacr.classes.DayNoise"><code class="xref py py-class docutils literal notranslate"><span class="pre">DayNoise</span></code></a> object</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.key">
<code class="sig-name descname">key</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.key" title="Permalink to this definition">¶</a></dt>
<dd><p>Station key for current object</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.ncomp">
<code class="sig-name descname">ncomp</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.ncomp" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of available components (either 2, 3 or 4)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.tf_list">
<code class="sig-name descname">tf_list</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.tf_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of possible transfer functions given the available
components.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>Dict</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.c11">
<code class="sig-name descname">c11</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.c11" title="Permalink to this definition">¶</a></dt>
<dd><p>Power spectra for component <cite>H1</cite>. Other identical attributes
are available for
the power, cross and rotated spectra: [11, 12, 1Z, 1P, 22, 2Z,
2P, ZZ, ZP, PP, HH, HZ, HP]</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><cite>numpy.ndarray</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.direc">
<code class="sig-name descname">direc</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.direc" title="Permalink to this definition">¶</a></dt>
<dd><p>Array of azimuths used in determining the tilt direction</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><cite>numpy.ndarray</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.tilt">
<code class="sig-name descname">tilt</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.tilt" title="Permalink to this definition">¶</a></dt>
<dd><p>Tilt direction from maximum coherence between rotated <cite>H1</cite> and
<cite>HZ</cite> components</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.QC">
<code class="sig-name descname">QC</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.QC" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether or not the method
<a class="reference internal" href="#obstools.atacr.classes.StaNoise.QC_sta_spectra" title="obstools.atacr.classes.StaNoise.QC_sta_spectra"><code class="xref py py-func docutils literal notranslate"><span class="pre">QC_sta_spectra()</span></code></a> has
been called.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.av">
<code class="sig-name descname">av</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.av" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether or not the method
<a class="reference internal" href="#obstools.atacr.classes.StaNoise.average_sta_spectra" title="obstools.atacr.classes.StaNoise.average_sta_spectra"><code class="xref py py-func docutils literal notranslate"><span class="pre">average_sta_spectra()</span></code></a> has
been called.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<p class="rubric">Examples</p>
<p>Initialize demo data</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">StaNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span> <span class="o">=</span> <span class="n">StaNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 01 to 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</pre></div>
</div>
<p>Check that <cite>daylist</cite> attribute has been deleted</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">daylist</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">AttributeError                            Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-4-a292a91450a9&gt; in &lt;module&gt;</span>
<span class="go">----&gt; 1 stanoise.daylist</span>
<span class="go">AttributeError: &#39;StaNoise&#39; object has no attribute &#39;daylist&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">dict_keys([&#39;initialized&#39;, &#39;c11&#39;, &#39;c22&#39;, &#39;cZZ&#39;, &#39;cPP&#39;, &#39;c12&#39;, &#39;c1Z&#39;, &#39;c1P&#39;,</span>
<span class="go">&#39;c2Z&#39;, &#39;c2P&#39;, &#39;cZP&#39;, &#39;cHH&#39;, &#39;cHZ&#39;, &#39;cHP&#39;, &#39;direc&#39;, &#39;tilt&#39;, &#39;f&#39;, &#39;nwins&#39;,</span>
<span class="go">&#39;ncomp&#39;, &#39;key&#39;, &#39;tf_list&#39;, &#39;QC&#39;, &#39;av&#39;])</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="obstools.atacr.classes.StaNoise.QC_sta_spectra">
<code class="sig-name descname">QC_sta_spectra</code><span class="sig-paren">(</span><em class="sig-param">pd=[0.004, 0.2], tol=2.0, alpha=0.05, fig_QC=False, debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.StaNoise.QC_sta_spectra" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to determine the days (for given time window) for which the
spectra are anomalous and should be discarded in the calculation of
the long-term transfer functions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pd</strong> (<em>list</em>) – Frequency corners of passband for calculating the spectra</p></li>
<li><p><strong>tol</strong> (<em>float</em>) – Tolerance threshold. If spectrum &gt; std*tol, window is flagged as
bad</p></li>
<li><p><strong>alpha</strong> (<em>float</em>) – Confidence interval for f-test</p></li>
<li><p><strong>fig_QC</strong> (<em>boolean</em>) – Whether or not to produce a figure showing the results of the
quality control</p></li>
<li><p><strong>debug</strong> (<em>boolean</em>) – Whether or not to plot intermediate steps in the QC procedure for
debugging</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.gooddays">
<code class="sig-name descname">gooddays</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.gooddays" title="Permalink to this definition">¶</a></dt>
<dd><p>List of booleans representing whether a day is good (True) or not
(False)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<p class="rubric">Examples</p>
<p>Import demo data, call method and generate final figure</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">obstools</span><span class="o">.</span><span class="n">atacr</span> <span class="kn">import</span> <span class="nn">StaNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span> <span class="o">=</span> <span class="n">StaNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 01 to 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">QC_sta_spectra</span><span class="p">(</span><span class="n">fig_QC</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">QC</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="obstools.atacr.classes.StaNoise.average_sta_spectra">
<code class="sig-name descname">average_sta_spectra</code><span class="sig-paren">(</span><em class="sig-param">fig_average=False</em>, <em class="sig-param">debug=False</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.StaNoise.average_sta_spectra" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to average the daily station spectra for good windows.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fig_average</strong> (<em>boolean</em>) – Whether or not to produce a figure showing the average daily
spectra</p></li>
<li><p><strong>debug</strong> (<em>boolean</em>) – Whether or not to plot intermediate steps in the QC procedure
for debugging</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.power">
<code class="sig-name descname">power</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.power" title="Permalink to this definition">¶</a></dt>
<dd><p>Container for the Power spectra</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#obstools.atacr.classes.Power" title="obstools.atacr.classes.Power"><code class="xref py py-class docutils literal notranslate"><span class="pre">Power</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.cross">
<code class="sig-name descname">cross</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.cross" title="Permalink to this definition">¶</a></dt>
<dd><p>Container for the Cross power spectra</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#obstools.atacr.classes.Cross" title="obstools.atacr.classes.Cross"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cross</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.StaNoise.rotation">
<code class="sig-name descname">rotation</code><a class="headerlink" href="#obstools.atacr.classes.StaNoise.rotation" title="Permalink to this definition">¶</a></dt>
<dd><p>Container for the Rotated power and cross spectra</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#obstools.atacr.classes.Cross" title="obstools.atacr.classes.Cross"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cross</span></code></a>, optional</p>
</dd>
</dl>
</dd></dl>

<p class="rubric">Examples</p>
<p>Average daily spectra for good days using default values and produce
final figure</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">obstools</span><span class="o">.</span><span class="n">atacr</span> <span class="kn">import</span> <span class="nn">StaNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span> <span class="o">=</span> <span class="n">StaNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 01 to 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">QC_sta_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">average_sta_spectra</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="obstools.atacr.classes.StaNoise.save">
<code class="sig-name descname">save</code><span class="sig-paren">(</span><em class="sig-param">filename</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.StaNoise.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to save the object to file using <cite>~Pickle</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – File name</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Run demo through all methods</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">StaNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span> <span class="o">=</span> <span class="n">StaNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 01 to 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">QC_sta_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">average_sta_spectra</span><span class="p">()</span>
</pre></div>
</div>
<p>Save object</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;stanoise_demo.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Check that it has been saved</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">glob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;./stanoise_demo.pkl&quot;</span><span class="p">)</span>
<span class="go">[&#39;./stanoise_demo.pkl&#39;]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="tfnoise">
<h4>TFNoise<a class="headerlink" href="#tfnoise" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="obstools.atacr.classes.TFNoise">
<em class="property">class </em><code class="sig-prename descclassname">obstools.atacr.classes.</code><code class="sig-name descname">TFNoise</code><span class="sig-paren">(</span><em class="sig-param">objnoise=None</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.TFNoise" title="Permalink to this definition">¶</a></dt>
<dd><p>A TFNoise object contains attributes that store the transfer function
information from multiple components (and component combinations).</p>
<p class="rubric">Notes</p>
<p>The object is initialized with either a processed
<a class="reference internal" href="#obstools.atacr.classes.DayNoise" title="obstools.atacr.classes.DayNoise"><code class="xref py py-class docutils literal notranslate"><span class="pre">DayNoise</span></code></a> or
<a class="reference internal" href="#obstools.atacr.classes.StaNoise" title="obstools.atacr.classes.StaNoise"><code class="xref py py-class docutils literal notranslate"><span class="pre">StaNoise</span></code></a> object. Each individual
spectral quantity is unpacked as an object attribute, but all of them
are discarded as the object is saved to disk and new container objects
are defined and saved.</p>
<dl class="attribute">
<dt id="obstools.atacr.classes.TFNoise.f">
<code class="sig-name descname">f</code><a class="headerlink" href="#obstools.atacr.classes.TFNoise.f" title="Permalink to this definition">¶</a></dt>
<dd><p>Frequency axis for corresponding time sampling parameters</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.TFNoise.c11">
<code class="sig-name descname">c11</code><a class="headerlink" href="#obstools.atacr.classes.TFNoise.c11" title="Permalink to this definition">¶</a></dt>
<dd><p>Power spectra for component <cite>H1</cite>. Other identical attributes are
available for the power, cross and rotated spectra:
[11, 12, 1Z, 1P, 22, 2Z, 2P, ZZ, ZP, PP, HH, HZ, HP]</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><cite>numpy.ndarray</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.TFNoise.tilt">
<code class="sig-name descname">tilt</code><a class="headerlink" href="#obstools.atacr.classes.TFNoise.tilt" title="Permalink to this definition">¶</a></dt>
<dd><p>Tile direction from maximum coherence between rotated <cite>H1</cite> and
<cite>HZ</cite> components</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.TFNoise.tf_list">
<code class="sig-name descname">tf_list</code><a class="headerlink" href="#obstools.atacr.classes.TFNoise.tf_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of possible transfer functions given the available
components.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>Dict</p>
</dd>
</dl>
</dd></dl>

<p class="rubric">Examples</p>
<p>Initialize a TFNoise object with a DayNoise object. The DayNoise
object must be processed for QC and averaging, otherwise the TFNoise
object will not initialize.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">DayNoise</span><span class="p">,</span> <span class="n">TFNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span> <span class="o">=</span> <span class="n">DayNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise</span> <span class="o">=</span> <span class="n">TFNoise</span><span class="p">(</span><span class="n">daynoise</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
  File <span class="nb">&quot;/Users/pascalaudet/Softwares/Python/Projects/dev/OBStools/obstools/atacr/classes.py&quot;</span>, line <span class="m">1215</span>, in <span class="n">__init__</span>
<span class="gr">Exception</span>: <span class="n">Error: Noise object has not been processed (QC and averaging) - aborting</span>
</pre></div>
</div>
<p>Now re-initialized with a processed DayNoise object</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">DayNoise</span><span class="p">,</span> <span class="n">TFNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span> <span class="o">=</span> <span class="n">DayNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">QC_daily_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">average_daily_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise</span> <span class="o">=</span> <span class="n">TFNoise</span><span class="p">(</span><span class="n">daynoise</span><span class="p">)</span>
</pre></div>
</div>
<p>Initialize a TFNoise object with a processed StaNoise object</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">StaNoise</span><span class="p">,</span> <span class="n">TFNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span> <span class="o">=</span> <span class="n">StaNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 01 to 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">QC_sta_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">average_sta_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise</span> <span class="o">=</span> <span class="n">TFNoise</span><span class="p">(</span><span class="n">stanoise</span><span class="p">)</span>
</pre></div>
</div>
<dl class="class">
<dt id="obstools.atacr.classes.TFNoise.TfDict">
<em class="property">class </em><code class="sig-name descname">TfDict</code><a class="headerlink" href="#obstools.atacr.classes.TFNoise.TfDict" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="obstools.atacr.classes.TFNoise.transfer_func">
<code class="sig-name descname">transfer_func</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.TFNoise.transfer_func" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to calculate transfer functions between multiple
components (and component combinations) from the averaged
(daily or station-averaged) noise spectra.</p>
<dl class="attribute">
<dt id="obstools.atacr.classes.TFNoise.transfunc">
<code class="sig-name descname">transfunc</code><a class="headerlink" href="#obstools.atacr.classes.TFNoise.transfunc" title="Permalink to this definition">¶</a></dt>
<dd><p>Container Dictionary for all possible transfer functions</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#obstools.atacr.classes.TFNoise.TfDict" title="obstools.atacr.classes.TFNoise.TfDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">TfDict</span></code></a></p>
</dd>
</dl>
</dd></dl>

<p class="rubric">Examples</p>
<p>Calculate transfer functions for a DayNoise object</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">DayNoise</span><span class="p">,</span> <span class="n">TFNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span> <span class="o">=</span> <span class="n">DayNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">QC_daily_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">average_daily_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise</span> <span class="o">=</span> <span class="n">TFNoise</span><span class="p">(</span><span class="n">daynoise</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise</span><span class="o">.</span><span class="n">transfer_func</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise</span><span class="o">.</span><span class="n">transfunc</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">dict_keys([&#39;ZP&#39;, &#39;Z1&#39;, &#39;Z2-1&#39;, &#39;ZP-21&#39;, &#39;ZH&#39;, &#39;ZP-H&#39;])</span>
</pre></div>
</div>
<p>Calculate transfer functions for a StaNoise object</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">StaNoise</span><span class="p">,</span> <span class="n">TFNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span> <span class="o">=</span> <span class="n">StaNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 01 to 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">QC_sta_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">average_sta_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise</span> <span class="o">=</span> <span class="n">TFNoise</span><span class="p">(</span><span class="n">daynoise</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise</span><span class="o">.</span><span class="n">transfer_func</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise</span><span class="o">.</span><span class="n">transfunc</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">dict_keys([&#39;ZP&#39;, &#39;Z1&#39;, &#39;Z2-1&#39;, &#39;ZP-21&#39;])</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="obstools.atacr.classes.TFNoise.save">
<code class="sig-name descname">save</code><span class="sig-paren">(</span><em class="sig-param">filename</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.TFNoise.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to save the object to file using <cite>~Pickle</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – File name</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Run demo through all methods</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">DayNoise</span><span class="p">,</span> <span class="n">StaNoise</span><span class="p">,</span> <span class="n">TFNoise</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span> <span class="o">=</span> <span class="n">DayNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">QC_daily_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">average_daily_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise_day</span> <span class="o">=</span> <span class="n">TFNoise</span><span class="p">(</span><span class="n">daynoise</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise_day</span><span class="o">.</span><span class="n">transfer_func</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span> <span class="o">=</span> <span class="n">StaNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 01 to 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">QC_sta_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">average_sta_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise_sta</span> <span class="o">=</span> <span class="n">TFNoise</span><span class="p">(</span><span class="n">stanoise</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise_sta</span><span class="o">.</span><span class="n">transfer_func</span><span class="p">()</span>
</pre></div>
</div>
<p>Save object</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise_day</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;tf_daynoise_demo.pkl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise_sta</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;tf_stanoise_demo.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Check that everything has been saved</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">glob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;./tf_daynoise_demo.pkl&quot;</span><span class="p">)</span>
<span class="go">[&#39;./tf_daynoise_demo.pkl&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;./tf_stanoise_demo.pkl&quot;</span><span class="p">)</span>
<span class="go">[&#39;./tf_stanoise_demo.pkl&#39;]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="eventstream">
<h4>EventStream<a class="headerlink" href="#eventstream" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="obstools.atacr.classes.EventStream">
<em class="property">class </em><code class="sig-prename descclassname">obstools.atacr.classes.</code><code class="sig-name descname">EventStream</code><span class="sig-paren">(</span><em class="sig-param">sta=None</em>, <em class="sig-param">sth=None</em>, <em class="sig-param">stp=None</em>, <em class="sig-param">tstamp=None</em>, <em class="sig-param">lat=None</em>, <em class="sig-param">lon=None</em>, <em class="sig-param">time=None</em>, <em class="sig-param">window=None</em>, <em class="sig-param">sampling_rate=None</em>, <em class="sig-param">ncomp=None</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.EventStream" title="Permalink to this definition">¶</a></dt>
<dd><p>An EventStream object contains attributes that store station-event
metadata and methods for applying the transfer functions to the various
components and produce corrected/cleaned vertical components.</p>
<p class="rubric">Notes</p>
<p>An <code class="docutils literal notranslate"><span class="pre">EventStream</span></code> object is defined as the data
(<code class="xref py py-class docutils literal notranslate"><span class="pre">Stream</span></code> object) are read from file or downloaded
from an <code class="docutils literal notranslate"><span class="pre">obspy</span></code> Client. Based on the available components, a list of
possible corrections is determined automatically.</p>
<dl class="attribute">
<dt id="obstools.atacr.classes.EventStream.sta">
<code class="sig-name descname">sta</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.sta" title="Permalink to this definition">¶</a></dt>
<dd><p>An instance of an stdb object</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">StdbElement</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.EventStream.key">
<code class="sig-name descname">key</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.key" title="Permalink to this definition">¶</a></dt>
<dd><p>Station key for current object</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.EventStream.sth">
<code class="sig-name descname">sth</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.sth" title="Permalink to this definition">¶</a></dt>
<dd><p>Stream containing three-component seismic data (traces are empty if
data are not available)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Stream</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.EventStream.stp">
<code class="sig-name descname">stp</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.stp" title="Permalink to this definition">¶</a></dt>
<dd><p>Stream containing pressure data (trace is empty if data are not
available)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Stream</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.EventStream.tstamp">
<code class="sig-name descname">tstamp</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.tstamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Time stamp for event</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.EventStream.evlat">
<code class="sig-name descname">evlat</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.evlat" title="Permalink to this definition">¶</a></dt>
<dd><p>Latitude of seismic event</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.EventStream.evlon">
<code class="sig-name descname">evlon</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.evlon" title="Permalink to this definition">¶</a></dt>
<dd><p>Longitude of seismic event</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.EventStream.evtime">
<code class="sig-name descname">evtime</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.evtime" title="Permalink to this definition">¶</a></dt>
<dd><p>Origin time of seismic event</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">UTCDateTime</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.EventStream.window">
<code class="sig-name descname">window</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.window" title="Permalink to this definition">¶</a></dt>
<dd><p>Length of time window in seconds</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.EventStream.fs">
<code class="sig-name descname">fs</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.fs" title="Permalink to this definition">¶</a></dt>
<dd><p>Sampling frequency (in Hz)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.EventStream.dt">
<code class="sig-name descname">dt</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.dt" title="Permalink to this definition">¶</a></dt>
<dd><p>Sampling distance in seconds</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.EventStream.npts">
<code class="sig-name descname">npts</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.npts" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of points in time series</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.EventStream.ncomp">
<code class="sig-name descname">ncomp</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.ncomp" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of available components (either 2, 3 or 4)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.EventStream.ev_list">
<code class="sig-name descname">ev_list</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.ev_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary of possible transfer functions given the available
components. This is determined during initialization.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>Dict</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.EventStream.correct">
<code class="sig-name descname">correct</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.correct" title="Permalink to this definition">¶</a></dt>
<dd><p>Container Dictionary for all possible corrections from the transfer
functions. This is calculated from the method
<a class="reference internal" href="#obstools.atacr.classes.EventStream.correct_data" title="obstools.atacr.classes.EventStream.correct_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">correct_data()</span></code></a></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#obstools.atacr.classes.EventStream.CorrectDict" title="obstools.atacr.classes.EventStream.CorrectDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">CorrectDict</span></code></a></p>
</dd>
</dl>
</dd></dl>

<p class="rubric">Examples</p>
<p>Get demo earthquake data as EventStream object</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">EventStream</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evstream</span> <span class="o">=</span> <span class="n">EventStream</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo earthquake data - March 09, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evstream</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">dict_keys([&#39;sta&#39;, &#39;key&#39;, &#39;sth&#39;, &#39;stp&#39;, &#39;tstamp&#39;, &#39;evlat&#39;, &#39;evlon&#39;, &#39;evtime&#39;,</span>
<span class="go">&#39;window&#39;, &#39;fs&#39;, &#39;dt&#39;, &#39;ncomp&#39;, &#39;ev_list&#39;])</span>
</pre></div>
</div>
<p>Plot the raw traces</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">obstools.atacr.plot</span> <span class="k">as</span> <span class="nn">plot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot</span><span class="o">.</span><span class="n">fig_event_raw</span><span class="p">(</span><span class="n">evstream</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mf">150.</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="_images/Figure_11.png" src="_images/Figure_11.png" />
</div>
<dl class="class">
<dt id="obstools.atacr.classes.EventStream.CorrectDict">
<em class="property">class </em><code class="sig-name descname">CorrectDict</code><a class="headerlink" href="#obstools.atacr.classes.EventStream.CorrectDict" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="obstools.atacr.classes.EventStream.correct_data">
<code class="sig-name descname">correct_data</code><span class="sig-paren">(</span><em class="sig-param">tfnoise</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.EventStream.correct_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to apply transfer functions between multiple components (and
component combinations) to produce corrected/cleaned vertical
components.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tfnoise</strong> (<a class="reference internal" href="#obstools.atacr.classes.TFNoise" title="obstools.atacr.classes.TFNoise"><code class="xref py py-class docutils literal notranslate"><span class="pre">TFNoise</span></code></a>) – Object that contains the noise transfer functions used in the
correction</p>
</dd>
</dl>
<dl class="attribute">
<dt>
<code class="sig-name descname">correct</code></dt>
<dd><p>Container Dictionary for all possible corrections from the
transfer functions</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#obstools.atacr.classes.EventStream.CorrectDict" title="obstools.atacr.classes.EventStream.CorrectDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">CorrectDict</span></code></a></p>
</dd>
</dl>
</dd></dl>

<p class="rubric">Examples</p>
<p>Let’s carry through the correction of the vertical component for a
single day of noise, say corresponding to the noise recorded on March
04, 2012. In practice, the DayNoise object should correspond to the
same day at that of the recorded earthquake to avoid bias in the
correction.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">DayNoise</span><span class="p">,</span> <span class="n">TFNoise</span><span class="p">,</span> <span class="n">EventStream</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span> <span class="o">=</span> <span class="n">DayNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">QC_daily_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">daynoise</span><span class="o">.</span><span class="n">average_daily_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise_day</span> <span class="o">=</span> <span class="n">TFNoise</span><span class="p">(</span><span class="n">daynoise</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise_day</span><span class="o">.</span><span class="n">transfer_func</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evstream</span> <span class="o">=</span> <span class="n">EventStream</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo earthquake data - March 09, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evstream</span><span class="o">.</span><span class="n">correct_data</span><span class="p">(</span><span class="n">tfnoise_day</span><span class="p">)</span>
</pre></div>
</div>
<p>Plot the corrected traces</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">obstools.atacr.plot</span> <span class="k">as</span> <span class="nn">plot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot</span><span class="o">.</span><span class="n">fig_event_corrected</span><span class="p">(</span><span class="n">evstream</span><span class="p">,</span> <span class="n">tfnoise_day</span><span class="o">.</span><span class="n">tf_list</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="_images/Figure_corrected_march04.png" src="_images/Figure_corrected_march04.png" />
</div>
<p>Carry out the same exercise but this time using a StaNoise object</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">obstools.atacr</span> <span class="kn">import</span> <span class="n">StaNoise</span><span class="p">,</span> <span class="n">TFNoise</span><span class="p">,</span> <span class="n">EventStream</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span> <span class="o">=</span> <span class="n">StaNoise</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo data - March 01 to 04, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">QC_sta_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stanoise</span><span class="o">.</span><span class="n">average_sta_spectra</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise_sta</span> <span class="o">=</span> <span class="n">TFNoise</span><span class="p">(</span><span class="n">stanoise</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tfnoise_sta</span><span class="o">.</span><span class="n">transfer_func</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evstream</span> <span class="o">=</span> <span class="n">EventStream</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
<span class="go">Uploading demo earthquake data - March 09, 2012, station 7D.M08A</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">evstream</span><span class="o">.</span><span class="n">correct_data</span><span class="p">(</span><span class="n">tfnoise_sta</span><span class="p">)</span>
</pre></div>
</div>
<p>Plot the corrected traces</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">obstools.atacr.plot</span> <span class="k">as</span> <span class="nn">plot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot</span><span class="o">.</span><span class="n">fig_event_corrected</span><span class="p">(</span><span class="n">evstream</span><span class="p">,</span> <span class="n">tfnoise_sta</span><span class="o">.</span><span class="n">tf_list</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="_images/Figure_corrected_sta.png" src="_images/Figure_corrected_sta.png" />
</div>
</dd></dl>

<dl class="method">
<dt id="obstools.atacr.classes.EventStream.save">
<code class="sig-name descname">save</code><span class="sig-paren">(</span><em class="sig-param">filename</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.EventStream.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Method to save the object to file using <cite>~Pickle</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<em>str</em>) – File name</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Following from the example outlined in method
<a class="reference internal" href="#obstools.atacr.classes.EventStream.correct_data" title="obstools.atacr.classes.EventStream.correct_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">correct_data()</span></code></a>, we simply
save the final object</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">evstream</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;evstream_demo.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Check that object has been saved</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">glob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;./evstream_demo.pkl&quot;</span><span class="p">)</span>
<span class="go">[&#39;./evstream_demo.pkl&#39;]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="container-classes">
<h3>Container Classes<a class="headerlink" href="#container-classes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="power">
<h4>Power<a class="headerlink" href="#power" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="obstools.atacr.classes.Power">
<em class="property">class </em><code class="sig-prename descclassname">obstools.atacr.classes.</code><code class="sig-name descname">Power</code><span class="sig-paren">(</span><em class="sig-param">c11=None</em>, <em class="sig-param">c22=None</em>, <em class="sig-param">cZZ=None</em>, <em class="sig-param">cPP=None</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.Power" title="Permalink to this definition">¶</a></dt>
<dd><p>Container for power spectra for each component, with any shape</p>
<dl class="attribute">
<dt id="obstools.atacr.classes.Power.c11">
<code class="sig-name descname">c11</code><a class="headerlink" href="#obstools.atacr.classes.Power.c11" title="Permalink to this definition">¶</a></dt>
<dd><p>Power spectral density for component 1 (any shape)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Power.c22">
<code class="sig-name descname">c22</code><a class="headerlink" href="#obstools.atacr.classes.Power.c22" title="Permalink to this definition">¶</a></dt>
<dd><p>Power spectral density for component 2 (any shape)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Power.cZZ">
<code class="sig-name descname">cZZ</code><a class="headerlink" href="#obstools.atacr.classes.Power.cZZ" title="Permalink to this definition">¶</a></dt>
<dd><p>Power spectral density for component Z (any shape)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Power.cPP">
<code class="sig-name descname">cPP</code><a class="headerlink" href="#obstools.atacr.classes.Power.cPP" title="Permalink to this definition">¶</a></dt>
<dd><p>Power spectral density for component P (any shape)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="cross">
<h4>Cross<a class="headerlink" href="#cross" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="obstools.atacr.classes.Cross">
<em class="property">class </em><code class="sig-prename descclassname">obstools.atacr.classes.</code><code class="sig-name descname">Cross</code><span class="sig-paren">(</span><em class="sig-param">c12=None</em>, <em class="sig-param">c1Z=None</em>, <em class="sig-param">c1P=None</em>, <em class="sig-param">c2Z=None</em>, <em class="sig-param">c2P=None</em>, <em class="sig-param">cZP=None</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.Cross" title="Permalink to this definition">¶</a></dt>
<dd><p>Container for cross-power spectra for each component pairs, with any shape</p>
<dl class="attribute">
<dt id="obstools.atacr.classes.Cross.c12">
<code class="sig-name descname">c12</code><a class="headerlink" href="#obstools.atacr.classes.Cross.c12" title="Permalink to this definition">¶</a></dt>
<dd><p>Cross-power spectral density for components 1 and 2 (any shape)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Cross.c1Z">
<code class="sig-name descname">c1Z</code><a class="headerlink" href="#obstools.atacr.classes.Cross.c1Z" title="Permalink to this definition">¶</a></dt>
<dd><p>Cross-power spectral density for components 1 and Z (any shape)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Cross.c1P">
<code class="sig-name descname">c1P</code><a class="headerlink" href="#obstools.atacr.classes.Cross.c1P" title="Permalink to this definition">¶</a></dt>
<dd><p>Cross-power spectral density for components 1 and P (any shape)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Cross.c2Z">
<code class="sig-name descname">c2Z</code><a class="headerlink" href="#obstools.atacr.classes.Cross.c2Z" title="Permalink to this definition">¶</a></dt>
<dd><p>Cross-power spectral density for components 2 and Z (any shape)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Cross.c2P">
<code class="sig-name descname">c2P</code><a class="headerlink" href="#obstools.atacr.classes.Cross.c2P" title="Permalink to this definition">¶</a></dt>
<dd><p>Cross-power spectral density for components 2 and P (any shape)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Cross.cZP">
<code class="sig-name descname">cZP</code><a class="headerlink" href="#obstools.atacr.classes.Cross.cZP" title="Permalink to this definition">¶</a></dt>
<dd><p>Cross-power spectral density for components Z and P (any shape)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="rotation">
<h4>Rotation<a class="headerlink" href="#rotation" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="obstools.atacr.classes.Rotation">
<em class="property">class </em><code class="sig-prename descclassname">obstools.atacr.classes.</code><code class="sig-name descname">Rotation</code><span class="sig-paren">(</span><em class="sig-param">cHH=None</em>, <em class="sig-param">cHZ=None</em>, <em class="sig-param">cHP=None</em>, <em class="sig-param">coh=None</em>, <em class="sig-param">ph=None</em>, <em class="sig-param">tilt=None</em>, <em class="sig-param">coh_value=None</em>, <em class="sig-param">phase_value=None</em>, <em class="sig-param">direc=None</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.classes.Rotation" title="Permalink to this definition">¶</a></dt>
<dd><p>Container for rotated spectra, with any shape</p>
<dl class="attribute">
<dt id="obstools.atacr.classes.Rotation.cHH">
<code class="sig-name descname">cHH</code><a class="headerlink" href="#obstools.atacr.classes.Rotation.cHH" title="Permalink to this definition">¶</a></dt>
<dd><p>Power spectral density for rotated horizontal component H (any shape)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Rotation.cHZ">
<code class="sig-name descname">cHZ</code><a class="headerlink" href="#obstools.atacr.classes.Rotation.cHZ" title="Permalink to this definition">¶</a></dt>
<dd><p>Cross-power spectral density for components H and Z (any shape)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Rotation.cHP">
<code class="sig-name descname">cHP</code><a class="headerlink" href="#obstools.atacr.classes.Rotation.cHP" title="Permalink to this definition">¶</a></dt>
<dd><p>Cross-power spectral density for components H and P (any shape)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Rotation.coh">
<code class="sig-name descname">coh</code><a class="headerlink" href="#obstools.atacr.classes.Rotation.coh" title="Permalink to this definition">¶</a></dt>
<dd><p>Coherence between horizontal components</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Rotation.ph">
<code class="sig-name descname">ph</code><a class="headerlink" href="#obstools.atacr.classes.Rotation.ph" title="Permalink to this definition">¶</a></dt>
<dd><p>Phase of cross-power spectrum between horizontal components</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Rotation.tilt">
<code class="sig-name descname">tilt</code><a class="headerlink" href="#obstools.atacr.classes.Rotation.tilt" title="Permalink to this definition">¶</a></dt>
<dd><p>Angle (azimuth) of tilt axis</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Rotation.coh_value">
<code class="sig-name descname">coh_value</code><a class="headerlink" href="#obstools.atacr.classes.Rotation.coh_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum coherence</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Rotation.phase_value">
<code class="sig-name descname">phase_value</code><a class="headerlink" href="#obstools.atacr.classes.Rotation.phase_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Phase at maximum coherence</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="obstools.atacr.classes.Rotation.direc">
<code class="sig-name descname">direc</code><a class="headerlink" href="#obstools.atacr.classes.Rotation.direc" title="Permalink to this definition">¶</a></dt>
<dd><p>Directions for which the coherence is calculated</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="module-obstools.atacr.utils">
<span id="utility-functions"></span><h3>Utility functions<a class="headerlink" href="#module-obstools.atacr.utils" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="#module-obstools.atacr.utils" title="obstools.atacr.utils"><code class="xref py py-mod docutils literal notranslate"><span class="pre">utils</span></code></a> contains several functions that are used in the
class methods of <cite>~obstools.atacr.classes</cite>.</p>
<dl class="function">
<dt id="obstools.atacr.utils.update_stats">
<code class="sig-prename descclassname">obstools.atacr.utils.</code><code class="sig-name descname">update_stats</code><span class="sig-paren">(</span><em class="sig-param">tr</em>, <em class="sig-param">stla</em>, <em class="sig-param">stlo</em>, <em class="sig-param">stel</em>, <em class="sig-param">cha</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.utils.update_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to include SAC metadata to <code class="xref py py-class docutils literal notranslate"><span class="pre">Trace</span></code> objects</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tr</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Trace</span></code> object) – Trace object to update</p></li>
<li><p><strong>stla</strong> (<em>float</em>) – Latitude of station</p></li>
<li><p><strong>stlo</strong> (<em>float</em>) – Longitude of station</p></li>
<li><p><strong>cha</strong> (<em>str</em>) – Channel for component</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>tr</strong> – Updated trace object</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Trace</span></code> object</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="obstools.atacr.utils.get_data">
<code class="sig-prename descclassname">obstools.atacr.utils.</code><code class="sig-name descname">get_data</code><span class="sig-paren">(</span><em class="sig-param">datapath</em>, <em class="sig-param">tstart</em>, <em class="sig-param">tend</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.utils.get_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to grab all available noise data given a path and data time range</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>datapath</strong> (<em>str</em>) – Path to noise data folder</p></li>
<li><p><strong>tstart</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">UTCDateTime</span></code>) – Start time for query</p></li>
<li><p><strong>tend</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">UTCDateTime</span></code>) – End time for query</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>tr1, tr2, trZ, trP</strong> – Corresponding trace objects for components H1, H2, HZ and HP. Returns empty traces
for missing components.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Trace</span></code> object</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="obstools.atacr.utils.get_event">
<code class="sig-prename descclassname">obstools.atacr.utils.</code><code class="sig-name descname">get_event</code><span class="sig-paren">(</span><em class="sig-param">eventpath</em>, <em class="sig-param">tstart</em>, <em class="sig-param">tend</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.utils.get_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to grab all available earthquake data given a path and data time range</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>eventpath</strong> (<em>str</em>) – Path to earthquake data folder</p></li>
<li><p><strong>tstart</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">UTCDateTime</span></code>) – Start time for query</p></li>
<li><p><strong>tend</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">UTCDateTime</span></code>) – End time for query</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>tr1, tr2, trZ, trP</strong> – Corresponding trace objects for components H1, H2, HZ and HP. Returns empty traces
for missing components.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Trace</span></code> object</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="obstools.atacr.utils.calculate_tilt">
<code class="sig-prename descclassname">obstools.atacr.utils.</code><code class="sig-name descname">calculate_tilt</code><span class="sig-paren">(</span><em class="sig-param">ft1, ft2, ftZ, ftP, f, goodwins, tiltfreq=[0.005, 0.035]</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.utils.calculate_tilt" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines tilt direction from maximum coherence between rotated H1 and Z.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ft2</strong><strong>, </strong><strong>ftZ</strong><strong>, </strong><strong>ftP</strong> (<em>ft1</em><em>,</em>) – Fourier transform of corresponding H1, H2, HZ and HP components</p></li>
<li><p><strong>f</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Frequency axis in Hz</p></li>
<li><p><strong>goodwins</strong> (<em>list</em>) – List of booleans representing whether a window is good (True) or not (False).
This attribute is returned from the method <a class="reference internal" href="#obstools.atacr.classes.DayNoise.QC_daily_spectra" title="obstools.atacr.classes.DayNoise.QC_daily_spectra"><code class="xref py py-func docutils literal notranslate"><span class="pre">QC_daily_spectra()</span></code></a></p></li>
<li><p><strong>tiltfreq</strong> (<em>list</em>) – Two floats representing the frequency band at which the tilt is calculated</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>cHH, cHZ, cHP</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Arrays of power and cross-spectral density functions of components HH (rotated H1
in direction of maximum tilt), HZ, and HP</p></li>
<li><p><strong>coh</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Coherence value between rotated H and Z components, as a function of directions (azimuths)</p></li>
<li><p><strong>ph</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Phase value between rotated H and Z components, as a function of directions (azimuths)</p></li>
<li><p><strong>direc</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Array of directions (azimuths) considered</p></li>
<li><p><strong>tilt</strong> (<em>float</em>) – Direction (azimuth) of maximum coherence between rotated H1 and Z</p></li>
<li><p><strong>coh_value</strong> (<em>float</em>) – Coherence value at tilt direction</p></li>
<li><p><strong>phase_value</strong> (<em>float</em>) – Phase value at tilt direction</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="obstools.atacr.utils.calculate_windowed_fft">
<code class="sig-prename descclassname">obstools.atacr.utils.</code><code class="sig-name descname">calculate_windowed_fft</code><span class="sig-paren">(</span><em class="sig-param">trace</em>, <em class="sig-param">ws</em>, <em class="sig-param">ss=None</em>, <em class="sig-param">hann=True</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.utils.calculate_windowed_fft" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates windowed Fourier transform</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trace</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Trace</span></code>) – Input trace data</p></li>
<li><p><strong>ws</strong> (<em>int</em>) – Window size, in number of samples</p></li>
<li><p><strong>ss</strong> (<em>int</em>) – Step size, or number of samples until next window</p></li>
<li><p><strong>han</strong> (<em>bool</em>) – Whether or not to apply a Hanning taper to data</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>ft</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Fourier transform of trace</p></li>
<li><p><strong>f</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Frequency axis in Hz</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="obstools.atacr.utils.smooth">
<code class="sig-prename descclassname">obstools.atacr.utils.</code><code class="sig-name descname">smooth</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">nd</em>, <em class="sig-param">axis=0</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.utils.smooth" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to smooth power spectral density functions from the convolution
of a boxcar function with the PSD</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Real-valued array to smooth (PSD)</p></li>
<li><p><strong>nd</strong> (<em>int</em>) – Number of samples over which to smooth</p></li>
<li><p><strong>axis</strong> (<em>int</em>) – axis over which to perform the smoothing</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>filt</strong> – Filtered data</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="obstools.atacr.utils.admittance">
<code class="sig-prename descclassname">obstools.atacr.utils.</code><code class="sig-name descname">admittance</code><span class="sig-paren">(</span><em class="sig-param">Gxy</em>, <em class="sig-param">Gxx</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.utils.admittance" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates admittance between two components</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Gxy</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Cross spectral density function of <cite>x</cite> and <cite>y</cite></p></li>
<li><p><strong>Gxx</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Power spectral density function of <cite>x</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Admittance between <cite>x</cite> and <cite>y</cite></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="obstools.atacr.utils.coherence">
<code class="sig-prename descclassname">obstools.atacr.utils.</code><code class="sig-name descname">coherence</code><span class="sig-paren">(</span><em class="sig-param">Gxy</em>, <em class="sig-param">Gxx</em>, <em class="sig-param">Gyy</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.utils.coherence" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates coherence between two components</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Gxy</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Cross spectral density function of <cite>x</cite> and <cite>y</cite></p></li>
<li><p><strong>Gxx</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Power spectral density function of <cite>x</cite></p></li>
<li><p><strong>Gyy</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Power spectral density function of <cite>y</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Coherence between <cite>x</cite> and <cite>y</cite></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="obstools.atacr.utils.phase">
<code class="sig-prename descclassname">obstools.atacr.utils.</code><code class="sig-name descname">phase</code><span class="sig-paren">(</span><em class="sig-param">Gxy</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.utils.phase" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates phase angle between two components</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>Gxy</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Cross spectral density function of <cite>x</cite> and <cite>y</cite></p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Phase angle between <cite>x</cite> and <cite>y</cite></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="obstools.atacr.utils.sliding_window">
<code class="sig-prename descclassname">obstools.atacr.utils.</code><code class="sig-name descname">sliding_window</code><span class="sig-paren">(</span><em class="sig-param">a</em>, <em class="sig-param">ws</em>, <em class="sig-param">ss=None</em>, <em class="sig-param">hann=True</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.utils.sliding_window" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to split a data array into overlapping, possibly tapered sub-windows</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – 1D array of data to split</p></li>
<li><p><strong>ws</strong> (<em>int</em>) – Window size in samples</p></li>
<li><p><strong>ss</strong> (<em>int</em>) – <dl class="simple">
<dt>Step size in samples. If not provided, window and step size</dt><dd><p>are equal.</p>
</dd>
</dl>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>out</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – 1D array of windowed data</p></li>
<li><p><strong>nd</strong> (<em>int</em>) – Number of windows</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-obstools.atacr.plot">
<span id="plotting-functions"></span><h3>Plotting functions<a class="headerlink" href="#module-obstools.atacr.plot" title="Permalink to this headline">¶</a></h3>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">plot</span></code> contains several functions for plotting the results
of the analysis at various final and intermediate steps.</p>
<dl class="function">
<dt id="obstools.atacr.plot.fig_QC">
<code class="sig-prename descclassname">obstools.atacr.plot.</code><code class="sig-name descname">fig_QC</code><span class="sig-paren">(</span><em class="sig-param">f</em>, <em class="sig-param">power</em>, <em class="sig-param">gooddays</em>, <em class="sig-param">ncomp</em>, <em class="sig-param">key=''</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.plot.fig_QC" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to plot the Quality-Control step of the analysis. This function is used
in both the <cite>obs_daily_spectra.py</cite> or <cite>obs_clean_spectra.py</cite> scripts.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>f</strong> (<code class="xref py py-mod docutils literal notranslate"><span class="pre">ndarray</span></code>) – Frequency axis (in Hz)</p></li>
<li><p><strong>power</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Power</span></code>) – Container for the Power spectra</p></li>
<li><p><strong>gooddays</strong> (<em>List</em>) – List of booleans representing whether a window is good (True) or not (False)</p></li>
<li><p><strong>ncomp</strong> (<em>int</em>) – Number of components used in analysis (can be 2, 3 or 4)</p></li>
<li><p><strong>key</strong> (<em>str</em>) – String corresponding to the station key under analysis</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="obstools.atacr.plot.fig_average">
<code class="sig-prename descclassname">obstools.atacr.plot.</code><code class="sig-name descname">fig_average</code><span class="sig-paren">(</span><em class="sig-param">f</em>, <em class="sig-param">power</em>, <em class="sig-param">bad</em>, <em class="sig-param">gooddays</em>, <em class="sig-param">ncomp</em>, <em class="sig-param">key=''</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.plot.fig_average" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to plot the averaged spectra (those qualified as ‘good’ in the
QC step). This function is used
in both the <cite>obs_daily_spectra.py</cite> or <cite>obs_clean_spectra.py</cite> scripts.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>f</strong> (<code class="xref py py-mod docutils literal notranslate"><span class="pre">ndarray</span></code>) – Frequency axis (in Hz)</p></li>
<li><p><strong>power</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Power</span></code>) – Container for the Power spectra</p></li>
<li><p><strong>bad</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Power</span></code>) – Container for the <em>bad</em> Power spectra</p></li>
<li><p><strong>gooddays</strong> (<em>List</em>) – List of booleans representing whether a window is good (True) or not (False)</p></li>
<li><p><strong>ncomp</strong> (<em>int</em>) – Number of components used in analysis (can be 2, 3 or 4)</p></li>
<li><p><strong>key</strong> (<em>str</em>) – String corresponding to the station key under analysis</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="obstools.atacr.plot.fig_av_cross">
<code class="sig-prename descclassname">obstools.atacr.plot.</code><code class="sig-name descname">fig_av_cross</code><span class="sig-paren">(</span><em class="sig-param">f</em>, <em class="sig-param">field</em>, <em class="sig-param">gooddays</em>, <em class="sig-param">ftype</em>, <em class="sig-param">ncomp</em>, <em class="sig-param">key=''</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.plot.fig_av_cross" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to plot the averaged cross-spectra (those qualified as ‘good’ in the
QC step). This function is used in the <cite>obs_daily_spectra.py</cite> script.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>f</strong> (<code class="xref py py-mod docutils literal notranslate"><span class="pre">ndarray</span></code>) – Frequency axis (in Hz)</p></li>
<li><p><strong>field</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Rotation</span></code>) – Container for the Power spectra</p></li>
<li><p><strong>gooddays</strong> (<em>List</em>) – List of booleans representing whether a window is good (True) or not (False)</p></li>
<li><p><strong>ftype</strong> (<em>str</em>) – Type of plot to be displayed. If ftype is Admittance, plot is loglog. Otherwise semilogx</p></li>
<li><p><strong>key</strong> (<em>str</em>) – String corresponding to the station key under analysis</p></li>
<li><p><strong>**kwargs</strong> (<em>None</em>) – Keyword arguments to modify plot</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="obstools.atacr.plot.fig_coh_ph">
<code class="sig-prename descclassname">obstools.atacr.plot.</code><code class="sig-name descname">fig_coh_ph</code><span class="sig-paren">(</span><em class="sig-param">coh</em>, <em class="sig-param">ph</em>, <em class="sig-param">direc</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.plot.fig_coh_ph" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to plot the coherence and phase between the rotated H and Z components,
used to characterize the tilt direction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>coh</strong> (<code class="xref py py-mod docutils literal notranslate"><span class="pre">ndarray</span></code>) – Coherence between rotated H and Z components</p></li>
<li><p><strong>ph</strong> (<code class="xref py py-mod docutils literal notranslate"><span class="pre">ndarray</span></code>) – Phase between rotated H and Z components</p></li>
<li><p><strong>direc</strong> (<code class="xref py py-mod docutils literal notranslate"><span class="pre">ndarray</span></code>) – Directions considered in maximizing coherence between H and Z</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="obstools.atacr.plot.fig_TF">
<code class="sig-prename descclassname">obstools.atacr.plot.</code><code class="sig-name descname">fig_TF</code><span class="sig-paren">(</span><em class="sig-param">f</em>, <em class="sig-param">day_trfs</em>, <em class="sig-param">day_list</em>, <em class="sig-param">sta_trfs</em>, <em class="sig-param">sta_list</em>, <em class="sig-param">skey=''</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.plot.fig_TF" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to plot the transfer functions available.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>f</strong> (<code class="xref py py-mod docutils literal notranslate"><span class="pre">ndarray</span></code>) – Frequency axis (in Hz)</p></li>
<li><p><strong>day_trfs</strong> (<em>Dict</em>) – Dictionary containing the transfer functions for the daily averages</p></li>
<li><p><strong>sta_trfs</strong> (<em>Dict</em>) – Dictionary containing the transfer functions for the station averages</p></li>
<li><p><strong>key</strong> (<em>str</em>) – String corresponding to the station key under analysis</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="obstools.atacr.plot.fig_event_raw">
<code class="sig-prename descclassname">obstools.atacr.plot.</code><code class="sig-name descname">fig_event_raw</code><span class="sig-paren">(</span><em class="sig-param">evstream</em>, <em class="sig-param">fmin</em>, <em class="sig-param">fmax</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.plot.fig_event_raw" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to plot the raw (although bandpassed) seismograms.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>evstream</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">EventStream</span></code>) – Container for the event stream data</p></li>
<li><p><strong>fmin</strong> (<em>float</em>) – Low frequency corner (in Hz)</p></li>
<li><p><strong>fmax</strong> (<em>float</em>) – High frequency corner (in Hz)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="obstools.atacr.plot.fig_event_corrected">
<code class="sig-prename descclassname">obstools.atacr.plot.</code><code class="sig-name descname">fig_event_corrected</code><span class="sig-paren">(</span><em class="sig-param">evstream</em>, <em class="sig-param">TF_list</em><span class="sig-paren">)</span><a class="headerlink" href="#obstools.atacr.plot.fig_event_corrected" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to plot the corrected vertical component seismograms.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>evstream</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">EventStream</span></code>) – Container for the event stream data</p></li>
<li><p><strong>Tf_list</strong> (<em>list</em>) – List of Dictionary elements of transfer functions used
for plotting the corrected vertical component.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</div>
<div class="section" id="scripts">
<h2>Scripts<a class="headerlink" href="#scripts" title="Permalink to this headline">¶</a></h2>
<p>There are several Python scripts that accompany <code class="docutils literal notranslate"><span class="pre">~obstools.atacr</span></code>. These can be used
in bash scripts to automate data processing. These include scripts to download noise and
event data, and perform tilt and compliance noise removal using either the default
program values or by refining parameters. All of them use a station database provided as a
<code class="docutils literal notranslate"><span class="pre">StDb</span></code> dictionary. These scripts are:</p>
<ul class="simple">
<li><p>atacr_download_data.py</p></li>
<li><p>atacr_download_event.py</p></li>
<li><p>atacr_daily_spectra.py</p></li>
<li><p>atacr_clean_spectra.py</p></li>
<li><p>atacr_transfer_functions.py</p></li>
<li><p>atacr_correct_event.py</p></li>
</ul>
<div class="section" id="atacr-download-data-py">
<h3><code class="docutils literal notranslate"><span class="pre">atacr_download_data.py</span></code><a class="headerlink" href="#atacr-download-data-py" title="Permalink to this headline">¶</a></h3>
<div class="section" id="description">
<h4>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h4>
<p>Downloads up to four-component (H1, H2, Z and P), day-long seismograms
to use in noise corrections of vertical
component data. Station selection is specified by a network and
station code. The database is provided as a <code class="docutils literal notranslate"><span class="pre">StDb</span></code> dictionary.</p>
</div>
<div class="section" id="usage">
<h4>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ atacr_download_data.py -h
Usage: atacr_download_data.py [options] &lt;station database&gt;

Script used to download and pre-process up to four-component (H1, H2, Z and
P), day-long seismograms to use in noise corrections of vertical component of
OBS data. Data are requested from the internet using the client services
framework for a given date range. The stations are processed one by one and
the data are stored to disk.

Options:
  -h, --help            show this help message and exit
  --keys=STKEYS         Specify a comma-separated list of station keys for
                        which to perform the analysis. These must be contained
                        within the station database. Partial keys will be used
                        to match against those in the dictionary. For
                        instance, providing IU will match with all stations in
                        the IU network. [Default processes all stations in the
                        database]
  -C CHANNELS, --channels=CHANNELS
                        Specify a comma-separated list of channels for which
                        to perform the transfer function analysis. Possible
                        options are H (for horizontal channels) or P (for
                        pressure channel). Specifying H allows for tilt
                        correction. Specifying P allows for compliance
                        correction. [Default looks for both horizontal and
                        pressure and allows for both tilt AND compliance
                        corrections]
  -O, --overwrite       Force the overwriting of pre-existing data. [Default
                        False]

  Server Settings:
    Settings associated with which datacenter to log into.

    -S SERVER, --Server=SERVER
                        Specify the server to connect to. Options include:
                        BGR, ETH, GEONET, GFZ, INGV, IPGP, IRIS, KOERI, LMU,
                        NCEDC, NEIP, NERIES, ODC, ORFEUS, RESIF, SCEDC, USGS,
                        USP. [Default IRIS]
    -U USERAUTH, --User-Auth=USERAUTH
                        Enter your IRIS Authentification Username and Password
                        (--User-Auth=&#39;username:authpassword&#39;) to access and
                        download restricted data. [Default no user and
                        password]

  Time Search Settings:
    Time settings associated with searching for day-long seismograms

    --start=STARTT      Specify a UTCDateTime compatible string representing
                        the start day for the data search. This will override
                        any station start times. [Default start date for each
                        station in database]
    --end=ENDT          Specify a UTCDateTime compatible string representing
                        the start time for the event search. This will
                        override any station end times [Default end date for
                        each station in database]

  Frequency Settings:
    Miscellaneous frequency settings

    --sampling-rate=NEW_SAMPLING_RATE
                        Specify new sampling rate (float, in Hz). [Default 5.]
    --pre-filt=PRE_FILT
                        Specify four comma-separated corner frequencies
                        (float, in Hz) for deconvolution pre-filter. [Default
                        0.001,0.005,45.,50.]
</pre></div>
</div>
</div>
</div>
<div class="section" id="atacr-daily-spectra-py">
<h3><code class="docutils literal notranslate"><span class="pre">atacr_daily_spectra.py</span></code><a class="headerlink" href="#atacr-daily-spectra-py" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id2">
<h4>Description<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>Extracts two-hour-long windows from the day-long data, calculates
power-spectral densities and flags windows for outlier from the PSD properties.
Station selection is specified by a network and station code. The database
is provided as a <code class="docutils literal notranslate"><span class="pre">StDb</span></code> dictionary.</p>
</div>
<div class="section" id="id3">
<h4>Usage<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ atacr_daily_spectra.py -h
Usage: atacr_daily_spectra.py [options] &lt;station database&gt;

Script used to extract shorter windows from the day-long seismograms,
calculate the power-spectral properties, flag windows for outlier PSDs and
calculate daily averages of the corresponding Fourier transforms. The stations
are processed one by one and the data are stored to disk. The program will
look for data saved in the previous steps and use all available components.

Options:
  -h, --help           show this help message and exit
  --keys=STKEYS        Specify a comma separated list of station keys for
                       which to perform the analysis. These must be contained
                       within the station database. Partial keys will be used
                       to match against those in the dictionary. For instance,
                       providing IU will match with all stations in the IU
                       network. [Default processes all stations in the
                       database]
  -O, --overwrite      Force the overwriting of pre-existing data. [Default
                       False]

  Parameter Settings:
    Miscellaneous default values and settings

    --window=WINDOW    Specify window length in seconds. Default value is
                       highly recommended. Program may not be stable for large
                       deviations from default value. [Default 7200. (or 2
                       hours)]
    --overlap=OVERLAP  Specify fraction of overlap between windows. [Default
                       0.3 (or 30%)]
    --minwin=MINWIN    Specify minimum number of &#39;good&#39; windows in any given
                       day to continue with analysis. [Default 10]
    --freq-band=PD     Specify comma-separated frequency limits (float, in Hz)
                       over which to calculate spectral features used in
                       flagging the days/windows. [Default 0.004,2.0]
    --tolerance=TOL    Specify parameter for tolerance threshold. If spectrum
                       &gt; std*tol, window is flagged as bad. [Default 1.5]
    --alpha=ALPHA      Specify confidence level for f-test, for iterative
                       flagging of windows. [Default 0.05, or 95% confidence]
    --raw              Raw spectra will be used in calculating spectral
                       features for flagging. [Default uses smoothed spectra]
    --no-rotation      Do not rotate horizontal components to tilt direction.
                       [Default calculates rotation]

  Figure Settings:
    Flags for plotting figures

    --figQC            Plot Quality-Control figure. [Default does not plot
                       figure]
    --debug            Plot intermediate steps for debugging. [Default does
                       not plot figure]
    --figAverage       Plot daily average figure. [Default does not plot
                       figure]
    --figCoh           Plot Coherence and Phase figure. [Default does not plot
                       figure]

  Time Search Settings:
    Time settings associated with searching for day-long seismograms

    --start=STARTT     Specify a UTCDateTime compatible string representing
                       the start day for the data search. This will override
                       any station start times. [Default start date of each
                       station in database]
    --end=ENDT         Specify a UTCDateTime compatible string representing
                       the start time for the data search. This will override
                       any station end times. [Default end date of each
                       station n database]
</pre></div>
</div>
</div>
</div>
<div class="section" id="atacr-clean-spectra-py">
<h3><code class="docutils literal notranslate"><span class="pre">atacr_clean_spectra.py</span></code><a class="headerlink" href="#atacr-clean-spectra-py" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id4">
<h4>Description<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>Extracts daily spectra calculated from <code class="docutils literal notranslate"><span class="pre">obs_daily_spectra.py</span></code> and
flags days for which the daily averages are outliers from the PSD properties.
Further averages the spectra over the whole period specified by <code class="docutils literal notranslate"><span class="pre">--start</span></code>
and <code class="docutils literal notranslate"><span class="pre">--end</span></code>. Station selection is specified by a network and station code.
The database is provided as a <code class="docutils literal notranslate"><span class="pre">StDb</span></code> dictionary.</p>
</div>
<div class="section" id="id5">
<h4>Usage<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ atacr_clean_spectra.py -h
Usage: atacr_clean_spectra.py [options] &lt;station database&gt;

Script used to extract daily spectra calculated from ``obs_daily_spectra.py``
and flag days for outlier PSDs and calculate spectral averages of the
corresponding Fourier transforms over the entire time period specified. The
stations are processed one by one and the data are stored to disk.

Options:
  -h, --help         show this help message and exit
  --keys=STKEYS      Specify a comma separated list of station keys for which
                     to perform the analysis. These must be contained within
                     the station database. Partial keys will be used to match
                     against those in the dictionary. For instance, providing
                     IU will match with all stations in the IU network.
                     [Default processes all stations in the database]
  -O, --overwrite    Force the overwriting of pre-existing data. [Default
                     False]

  Parameter Settings:
    Miscellaneous default values and settings

    --freq-band=PD   Specify comma-separated frequency limits (float, in Hz)
                     over which to calculate spectral features used in
                     flagging the days/windows. [Default 0.004,2.0]
    --tolerance=TOL  Specify parameter for tolerance threshold. If spectrum &gt;
                     std*tol, window is flagged as bad. [Default 1.5]
    --alpha=ALPHA    Confidence level for f-test, for iterative flagging of
                     windows. [Default 0.05, or 95% confidence]

  Figure Settings:
    Flags for plotting figures

    --figQC          Plot Quality-Control figure. [Default does not plot
                     figure]
    --debug          Plot intermediate steps for debugging. [Default does not
                     plot figure]
    --figAverage     Plot daily average figure. [Default does not plot figure]
    --figCoh         Plot Coherence and Phase figure. [Default does not plot
                     figure]
    --figCross       Plot cross-spectra figure. [Default does not plot figure]

  Time Search Settings:
    Time settings associated with searching for day-long seismograms

    --start=STARTT   Specify a UTCDateTime compatible string representing the
                     start day for the data search. This will override any
                     station start times. [Default start date of each station
                     in database]
    --end=ENDT       Specify a UTCDateTime compatible string representing the
                     start time for the event search. This will override any
                     station end times. [Default end date of each station in
                     database]
</pre></div>
</div>
</div>
</div>
<div class="section" id="atacr-transfer-functions-py">
<h3><code class="docutils literal notranslate"><span class="pre">atacr_transfer</span> <span class="pre">functions.py</span></code><a class="headerlink" href="#atacr-transfer-functions-py" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id6">
<h4>Description<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>Calculates transfer functions using the noise windows flagged as <em>good</em>, for either
a single day (from <code class="docutils literal notranslate"><span class="pre">obs_daily_spectra.py</span></code>) or for those averaged over several days
(from <code class="docutils literal notranslate"><span class="pre">obs_clean_spectra.py</span></code>), if available. The transfer functions are stored to disk.
Station selection is specified by a network and station code. The database is
provided as a <code class="docutils literal notranslate"><span class="pre">StDb</span></code> dictionary.</p>
</div>
<div class="section" id="id7">
<h4>Usage<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ atacr_transfer_functions.py -h
Usage: atacr_transfer_functions.py [options] &lt;station database&gt;

Script used to calculate transfer functions between various components, to be
used in cleaning vertical component of OBS data. The noise data can be those
obtained from the daily spectra (i.e., from ``obs_daily_spectra.py``) or those
obtained from the averaged noise spectra (i.e., from ``obs_clean_spectra.py``).
Flags are available to specify the source of data to use as well as the time
range over which to calculate the transfer functions. The stations are
processed one by one and the data are stored to disk.

Options:
  -h, --help        show this help message and exit
  --keys=STKEYS     Specify a comma separated list of station keys for which
                    to perform the analysis. These must be contained within
                    the station database. Partial keys will be used to match
                    against those in the dictionary. For instance, providing
                    IU will match with all stations in the IU network.
                    [Default processes all stations in the database]
  -O, --overwrite   Force the overwriting of pre-existing data. [Default
                    False]

  Parameter Settings:
    Miscellaneous default values and settings

    --skip-daily    Skip daily spectral averages in construction of transfer
                    functions. [Default False]
    --skip-clean    Skip cleaned spectral averages in construction of transfer
                    functions. Defaults to True if data cannot be found in
                    default directory. [Default False]

  Figure Settings:
    Flags for plotting figures

    --figTF         Plot transfer function figure. [Default does not plot
                    figure]

  Time Search Settings:
    Time settings associated with searching for day-long seismograms

    --start=STARTT  Specify a UTCDateTime compatible string representing the
                    start day for the data search. This will override any
                    station start times. [Default start date of each station
                    in database]
    --end=ENDT      Specify a UTCDateTime compatible string representing the
                    start time for the event search. This will override any
                    station end times. [Default end date of each station in
                    database]
</pre></div>
</div>
</div>
</div>
<div class="section" id="atacr-download-event-py">
<h3><code class="docutils literal notranslate"><span class="pre">atacr_download_event.py</span></code><a class="headerlink" href="#atacr-download-event-py" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id8">
<h4>Description<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>Downloads up to four-component (H1, H2, Z and P), two-hour-long seismograms
for individual seismic events to use in noise corrections of vertical
component data. Station selection is specified by a network and
station code. The database is provided as a <code class="docutils literal notranslate"><span class="pre">StDb</span></code> dictionary.</p>
</div>
<div class="section" id="id9">
<h4>Usage<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ atacr_download_event.py -h
Usage: atacr_download_event.py [options] &lt;station database&gt;

Script used to download and pre-process up to four-component (H1, H2, Z and P), two-
hour-long seismograms for individual events on which to apply the de-noising
algorithms. Data are requested from the internet using the client services
framework for a given date range. The stations are processed one by one and
the data are stored to disk.

Options:
  -h, --help            show this help message and exit
  --keys=STKEYS         Specify a comma separated list of station keys for
                        which to perform the analysis. These must be contained
                        within the station database. Partial keys will be used
                        to match against those in the dictionary. For
                        instance, providing IU will match with all stations in
                        the IU network [Default processes all stations in the
                        database]
  -C CHANNELS, --channels=CHANNELS
                        Specify a comma-separated list of channels for which
                        to perform the transfer function analysis. Possible
                        options are H (for horizontal channels) or P (for
                        pressure channel). Specifying H allows for tilt
                        correction. Specifying P allows for compliance
                        correction. [Default looks for both horizontal and
                        pressure and allows for both tilt AND compliance
                        corrections]
  -O, --overwrite       Force the overwriting of pre-existing data. [Default
                        False]

  Server Settings:
    Settings associated with which datacenter to log into.

    -S SERVER, --Server=SERVER
                        Specify the server to connect to. Options include:
                        BGR, ETH, GEONET, GFZ, INGV, IPGP, IRIS, KOERI, LMU,
                        NCEDC, NEIP, NERIES, ODC, ORFEUS, RESIF, SCEDC, USGS,
                        USP. [Default IRIS]
    -U USERAUTH, --User-Auth=USERAUTH
                        Enter your IRIS Authentification Username and Password
                        (--User-Auth=&#39;username:authpassword&#39;) to access and
                        download restricted data. [Default no user and
                        password]

  Event Settings:
    Settings associated with refining the events to include in matching
    station pairs

    --start=STARTT      Specify a UTCDateTime compatible string representing
                        the start time for the event search. This will
                        override any station start times. [Default start date
                        of each station in database]
    --end=ENDT          Specify a UTCDateTime compatible string representing
                        the start time for the event search. This will
                        override any station end times [Default end date of
                        each station in database]
    -R, --reverse-order
                        Reverse order of events. Default behaviour starts at
                        oldest event and works towards most recent. Specify
                        reverse order and instead the program will start with
                        the most recent events and work towards older
    --min-mag=MINMAG    Specify the minimum magnitude of event for which to
                        search. [Default 5.5]
    --max-mag=MAXMAG    Specify the maximum magnitude of event for which to
                        search. [Default None, i.e. no limit]

  Geometry Settings:
    Settings associatd with the event-station geometries

    --min-dist=MINDIST  Specify the minimum great circle distance (degrees)
                        between the station and event. [Default 30]
    --max-dist=MAXDIST  Specify the maximum great circle distance (degrees)
                        between the station and event. [Default 120]

  Frequency Settings:
    Miscellaneous frequency settings

    --sampling-rate=NEW_SAMPLING_RATE
                        Specify new sampling rate (float, in Hz). [Default 5.]
    --pre-filt=PRE_FILT
                        Specify four comma-separated corner frequencies
                        (float, in Hz) for deconvolution pre-filter. [Default
                        0.001,0.005,45.,50.]
</pre></div>
</div>
</div>
</div>
<div class="section" id="atacr-correct-event-py">
<h3><code class="docutils literal notranslate"><span class="pre">atacr_correct_event.py</span></code><a class="headerlink" href="#atacr-correct-event-py" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id10">
<h4>Description<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>Calculates transfer functions using the noise windows flagged as <em>good</em>, for either
a single day (from <code class="docutils literal notranslate"><span class="pre">obs_daily_spectra.py</span></code>) or for those averaged over several days
(from <code class="docutils literal notranslate"><span class="pre">obs_clean_spectra.py</span></code>), if available. The transfer functions are stored to disk.
Station selection is specified by a network and station code. The database is provided as a
<code class="docutils literal notranslate"><span class="pre">StDb</span></code> dictionary.</p>
</div>
<div class="section" id="id11">
<h4>Usage<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ atacr_correct_event.py -h
Usage: atacr_correct_event.py [options] &lt;station database&gt;

Script used to extract transfer functions between various components, and use
them to clean vertical component of OBS data for selected events. The noise
data can be those obtained from the daily spectra (i.e., from
``obs_daily_spectra.py``) or those obtained from the averaged noise spectra
(i.e., from ``obs_clean_spectra.py``). Flags are available to specify the source
of data to use as well as the time range for given events. The stations are
processed one by one and the data are stored to disk.

Options:
  -h, --help        show this help message and exit
  --keys=STKEYS     Specify a comma separated list of station keys for which
                    to perform the analysis. These must be contained within
                    the station database. Partial keys will be used to match
                    against those in the dictionary. For instance, providing
                    IU will match with all stations in the IU network.
                    [Default processes all stations in the database]
  -O, --overwrite   Force the overwriting of pre-existing data. [Default
                    False]

  Parameter Settings:
    Miscellaneous default values and settings

    --skip-daily    Skip daily spectral averages in application of transfer
                    functions. [Default False]
    --skip-clean    Skip cleaned spectral averages in application of transfer
                    functions. [Default False]
    --fmin=FMIN     Low frequency corner (in Hz) for plotting the raw (un-
                    corrected) seismograms. Filter is a 2nd order, zero phase
                    butterworth filter. [Default 1./150.]
    --fmax=FMAX     High frequency corner (in Hz) for plotting the raw (un-
                    corrected) seismograms. Filter is a 2nd order, zero phase
                    butterworth filter. [Default 1./10.]

  Figure Settings:
    Flags for plotting figures

    --figRaw        Plot raw seismogram figure. [Default does not plot figure]
    --figClean      Plot cleaned vertical seismogram figure. [Default does not
                    plot figure]

  Time Search Settings:
    Time settings associated with searching for specific event-related
    seismograms

    --start=STARTT  Specify a UTCDateTime compatible string representing the
                    start day for the event search. This will override any
                    station start times. [Default start date of each station
                    in database]
    --end=ENDT      Specify a UTCDateTime compatible string representing the
                    start time for the event search. This will override any
                    station end times. [Default end date of each station in
                    database]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="tutorial">
<h2>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here we roughly follow the steps highlighted in the
<a class="reference external" href="https://github.com/helenjanisz/ATaCR/blob/master/ATaCR_Manual.pdf">Matlab tutorial</a>
for this code and reproduce
the various figures. The examples provided below are for one month of data
(March 2012) recorded at station M08A of the Cascadia Initiative Experiment.
Corrections are applied to a magnitude 6.6 earthquake that occurred near
Vanuatu on March 9, 2012.</p>
</div>
<div class="section" id="creating-the-stdb-database">
<h3>0. Creating the <code class="docutils literal notranslate"><span class="pre">StDb</span></code> Database<a class="headerlink" href="#creating-the-stdb-database" title="Permalink to this headline">¶</a></h3>
<p>All the scripts provided require a <code class="docutils literal notranslate"><span class="pre">StDb</span></code> database containing station
information and metadata. Let’s first create this database for station
M08A and send the prompt to a logfile</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ query_fdsn_stdb.py -N 7D -C ?H? -S M08A M08A &gt; logfile
</pre></div>
</div>
<p>To check the station info for M08A, use the program <code class="docutils literal notranslate"><span class="pre">ls_stdb.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls_stdb.py M08A.pkl
 Listing Station Pickle: M08A.pkl
 7D.M08A
 --------------------------------------------------------------------------
 1) 7D.M08A
      Station: 7D M08A
       Alternate Networks: None
       Channel: BH ;  Location: --
       Lon, Lat, Elev:  44.11870, -124.89530,  -0.126
       StartTime: 2011-10-20 00:00:00
       EndTime:   2012-07-18 23:59:59
       Status:    open
       Polarity: 1
       Azimuth Correction: 0.000000
</pre></div>
</div>
</div>
<div class="section" id="download-noise-data">
<h3>1. Download noise data<a class="headerlink" href="#download-noise-data" title="Permalink to this headline">¶</a></h3>
<p>We wish to download one month of data for the station M08A for March 2012.
The various options above allow us to select the additional channels to specify
(e.g., <code class="docutils literal notranslate"><span class="pre">-C</span> <span class="pre">H,P</span></code> for both horizontal and pressure data - which is the default
setting). Default frequency settings for data pre-processing match those of
the Matlab <code class="docutils literal notranslate"><span class="pre">ATaCR</span></code> software and can therefore be ignore when calling the program.
Since the file <code class="docutils literal notranslate"><span class="pre">M08A.pkl</span></code> contains only one station, it is not necessary to specify a
key. This option would be useful if the database contained several stations
and we were only interested in downloading data for M08A. In this case, we would
specify <code class="docutils literal notranslate"><span class="pre">--keys=M08A</span></code> or <code class="docutils literal notranslate"><span class="pre">--keys=7D.M08A</span></code>.
The only required options at this point are the <code class="docutils literal notranslate"><span class="pre">--start</span></code> and <code class="docutils literal notranslate"><span class="pre">--end</span></code> options
to specify the dates for which data will will be downloaded.</p>
<p>If you change your mind about the pre-processing options, you can always re-run the
following line with the option <code class="docutils literal notranslate"><span class="pre">-O</span></code>, which will over-write the data saved to disk.</p>
<p>To download all broadband seismic and pressure data, simply type in a terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ atacr_download_data.py --start=2012-03-01 --end=2012-04-01 M08A.pkl
</pre></div>
</div>
<p>An example log printed on the terminal will look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Path to DATA/7D.M08A/ doesn`t exist - creating it

|===============================================|
|===============================================|
|                       M08A                    |
|===============================================|
|===============================================|
|  Station: 7D.M08A                             |
|      Channel: BH; Locations: --               |
|      Lon: -124.90; Lat:  44.12                |
|      Start time: 2011-10-20                   |
|      End time:   2012-07-18                   |
|-----------------------------------------------|
| Searching day-long files:                     |
|   Start: 2012-03-01                           |
|   End:   2012-04-01                           |

***********************************************************
* Downloading day-long data for key 7D.M08A and day 2012.61
*
* Channels selected: [&#39;H&#39;, &#39;P&#39;] and vertical
*   2012.061.*SAC
*   -&gt; Downloading Seismic data...
*      ...done
*   -&gt; Downloading Pressure data...
*      ...done
*   -&gt; Removing responses - Seismic data
 WARNING: FIR normalized: sum[coef]=9.767192E-01;
 WARNING: FIR normalized: sum[coef]=9.767192E-01;
 WARNING: FIR normalized: sum[coef]=9.767192E-01;
*   -&gt; Removing responses - Pressure data
 WARNING: FIR normalized: sum[coef]=9.767192E-01;

***********************************************************
* Downloading day-long data for key 7D.M08A and day 2012.62
*
* Channels selected: [&#39;H&#39;, &#39;P&#39;] and vertical
*   2012.062.*SAC
*   -&gt; Downloading Seismic data...

...
</pre></div>
</div>
<p>And so on until all day-long files have been downloaded. You will
notice that a folder called <code class="docutils literal notranslate"><span class="pre">DATA/7D.M08A/</span></code> has been created.
This is where all day-long files will be stored on disk.</p>
</div>
<div class="section" id="qc-for-daily-spectral-averages">
<h3>2. QC for daily spectral averages<a class="headerlink" href="#qc-for-daily-spectral-averages" title="Permalink to this headline">¶</a></h3>
<p>For this step, there are several Parameter Settings that can be tuned. Once again,
the default values are the ones used to reproduce the results of the Matlab
ATaCR software and can be left un-changed. The Time Search Settings can be used
to look at a subset of the available day-long data files. Here these options
can be ignored since we wish to look at all the availble data that we just downloaded.
We can therefore type in a terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ atacr_daily_spectra.py M08A.pkl

Path to SPECTRA/7D.M08A/ doesn`t exist - creating it

|===============================================|
|===============================================|
|                       M08A                    |
|===============================================|
|===============================================|
|  Station: 7D.M08A                             |
|      Channel: BH; Locations: --               |
|      Lon: -124.90; Lat:  44.12                |
|      Start time: 2011-10-20 00:00:00          |
|      End time:   2012-07-18 23:59:59          |
|-----------------------------------------------|

**********************************************************************
* Calculating noise spectra for key 7D.M08A and day 2012.061
*   12 good windows. Proceeding...

**********************************************************************
* Calculating noise spectra for key 7D.M08A and day 2012.062
*   14 good windows. Proceeding...

**********************************************************************
* Calculating noise spectra for key 7D.M08A and day 2012.063
*   16 good windows. Proceeding...

...
</pre></div>
</div>
<p>And so on until all available data have been processed. The software stores the
<code class="docutils literal notranslate"><span class="pre">obstools.atacr.classes.DayNoise</span></code> objects to a newly
created folder called <code class="docutils literal notranslate"><span class="pre">SPECTRA/7D.M08A/</span></code>. To produce figures for visualization,
we can re-run the above script but now use the plotting options to look
at one day of the month (March 04, 2012). In this case we need to over-write the
previous results (option <code class="docutils literal notranslate"><span class="pre">-O</span></code>) and specify the date of interest:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ atacr_daily_spectra.py -O --figQC --figAverage --start=2012-03-04 --end=2012-03-05 M08A.pkl &gt; logfile
</pre></div>
</div>
<p>The script will produce several figures, including Figures 2 and 3 (separated
into 3a and 3b below). Several intermediate steps are also produces, which show
all the raw data and the window classification into good and bad windows for
subsequent analysis.</p>
<div class="figure align-center">
<img alt="_images/Figure_2.png" src="_images/Figure_2.png" />
</div>
<p>Figure 2: Daily spectrogram for the vertical (Z), horizontals (H1, H2), and pressure
(P) components.</p>
<div class="figure align-center">
<img alt="_images/Figure_3a.png" src="_images/Figure_3a.png" />
</div>
<p>Figure 3a: Power spectral density (PSD) functions for the Z, H1, H2, and P compo-
nents from a single day of data (M08A, March 4, 2012, same as in Figure 2). The left
column shows PSDs for each individual window; PSDs from windows that did not
pass the quality control are colored red.</p>
<div class="figure align-center">
<img alt="_images/Figure_3b.png" src="_images/Figure_3b.png" />
</div>
<p>Figure 3a: Daily average PSD of bad (red) and good (black) windows.</p>
</div>
<div class="section" id="qc-for-clean-station-averages">
<h3>3. QC for clean station averages<a class="headerlink" href="#qc-for-clean-station-averages" title="Permalink to this headline">¶</a></h3>
<p>Now that we have processed daily spectra for all available components, it is
possible to further average the spectra over multiple days to produce a cleaned
station average. It is still possible to specify a date range over which to
average the spectra, thus giving flexibility in the production of the station
averages. Parameter settings are similar to those used in <code class="docutils literal notranslate"><span class="pre">atacr_daily_spectra.py</span></code>
but further include the option of plotting the averaged cross-spectral properties.
To calcualte a single station average for the entire month of March 2012 (and
therefore using all available data) and plot the results, we can type in a terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ atacr_clean_spectra.py --figQC --figAverage --figCoh --figCross M08A.pkl

Path to AVG_STA/7D.M08A/ doesn`t exist - creating it

|===============================================|
|===============================================|
|                       M08A                    |
|===============================================|
|===============================================|
|  Station: 7D.M08A                             |
|      Channel: BH; Locations: --               |
|      Lon: -124.90; Lat:  44.12                |
|      Start time: 2011-10-20 00:00:00          |
|      End time:   2012-07-18 23:59:59          |
|-----------------------------------------------|

**********************************************************************
* Calculating noise spectra for key 7D.M08A and day 2012.061
*   -&gt; file SPECTRA/7D.M08A/2012.061.spectra.pkl found - loading

**********************************************************************
* Calculating noise spectra for key 7D.M08A and day 2012.062
*   -&gt; file SPECTRA/7D.M08A/2012.062.spectra.pkl found - loading

...
</pre></div>
</div>
<p>And so on until all <code class="docutils literal notranslate"><span class="pre">DayNoise</span></code> objects are averaged into a <code class="docutils literal notranslate"><span class="pre">StaNoise</span></code>
object, which is saved to a newly created folder called <code class="docutils literal notranslate"><span class="pre">AVG_STA/7D.M08A/</span></code>.
Several figures are also produced, including Figures 4, 6-9.</p>
<div class="figure align-center">
<img alt="_images/Figure_4.png" src="_images/Figure_4.png" />
</div>
<p>Figure 4: The orientation of maximum coherence between the vertical and the two
horizontal components for M08A during March 2012. (Left) Coherence as a function
of angle from the H1 component. (Right) Phase as a function of the angle. In this
example, the coherence is low indicating the absence of dominant, uni-directional tilt
noise.</p>
<div class="figure align-center">
<img alt="_images/Figure_6.png" src="_images/Figure_6.png" />
</div>
<p>Figure 6: The daily PSDs plotted for the vertical (Z), horizontal (H1, H2), and
pressure (P) components for March 2012 at station M08A. Each line is a daily PSD.
Gray colors indicate days that were accepted by the second quality control step,
while the red colors indicate days that were discarded.</p>
<div class="figure align-center">
<img alt="_images/Figure_7.png" src="_images/Figure_7.png" />
</div>
<p>Figure 7: The daily coherences between pairs of components as indicated above each
subplot for March 2012 at station M08A (e.g. 1Z - coherence between Horizontal 1
and Vertical). Each line represents average coherence for a single day in the data
set. Gray colors indicate days that were accepted by the second quality control step,
while the red colors indicate days that were discarded. Note that some definitions
are different (e.g., <code class="docutils literal notranslate"><span class="pre">ZP</span></code> vs <code class="docutils literal notranslate"><span class="pre">PZ</span></code>) than those used in the Matlab Tutorial.</p>
<div class="figure align-center">
<img alt="_images/Figure_8.png" src="_images/Figure_8.png" />
</div>
<p>Figure 8: The daily admittances between pairs of components as indicated above
(see Figure 7) each subplot for March 2012 at station M08A. Each line is a daily
admittance. Gray colors indicate days that were accepted by the second quality
control step, while the red colors indicate days that were discarded.
Note that some definitions are different (e.g., <code class="docutils literal notranslate"><span class="pre">ZP</span></code> vs <code class="docutils literal notranslate"><span class="pre">PZ</span></code>) than those used
in the Matlab Tutorial.</p>
<div class="figure align-center">
<img alt="_images/Figure_9.png" src="_images/Figure_9.png" />
</div>
<p>Figure 9: The daily phases between pairs of components as indicated above (see
Figure 7) each subplot for March 2012 at station M08A. Each line is a daily phase.
Gray colors indicate days that were accepted by the second quality control step,
while the red colors indicate days that were discarded. Note that some definitions
are different (e.g., <code class="docutils literal notranslate"><span class="pre">ZP</span></code> vs <code class="docutils literal notranslate"><span class="pre">PZ</span></code>) than those used in the Matlab Tutorial.</p>
</div>
<div class="section" id="transfer-function-calculation">
<h3>4. Transfer function calculation<a class="headerlink" href="#transfer-function-calculation" title="Permalink to this headline">¶</a></h3>
<p>Once the <code class="docutils literal notranslate"><span class="pre">StaNoise</span></code> objects have been produced and saved to disk, the transfer
functions across all available components can be calculated. By default the software
will calculate the ones for which the spectral averages are available.</p>
<p>For compliance only (i.e., only <code class="docutils literal notranslate"><span class="pre">?HZ</span></code> and <code class="docutils literal notranslate"><span class="pre">?XH?</span></code> components are available),
the only transfer function possible is:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ZP</span></code></p></li>
</ul>
<p>For tilt only (i.e., all of <code class="docutils literal notranslate"><span class="pre">?HZ,1,2</span></code> components are available, but not <code class="docutils literal notranslate"><span class="pre">?XH</span></code>),
the transfer functions are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Z1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Z2-1</span></code></p></li>
</ul>
<p>For both tilt and compliance (i.e., all four components are available), the
following transfer functions are possible:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Z1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Z2-1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ZP</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ZP-21</span></code></p></li>
</ul>
<p>If you are using a <code class="docutils literal notranslate"><span class="pre">DayNoise</span></code> object to calculate the transfer functions,
the following may also be possible (if all components are available):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ZH</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ZP-H</span></code></p></li>
</ul>
<p>In this example we calculate all available transfer functions for all available data.
In this case we do not need to specify any option and type in a terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ atacr_transfer_functions.py M08A.pkl

Path to TF_STA/7D.M08A/ doesn&#39;t exist - creating it

|===============================================|
|===============================================|
|                       M08A                    |
|===============================================|
|===============================================|
|  Station: 7D.M08A                             |
|      Channel: BH; Locations: --               |
|      Lon: -124.90; Lat:  44.12                |
|      Start time: 2011-10-20 00:00:00          |
|      End time:   2012-07-18 23:59:59          |
|-----------------------------------------------|

**********************************************************************
* Calculating transfer functions for key 7D.M08A and day 2012.088

**********************************************************************
* Calculating transfer functions for key 7D.M08A and day 2012.075

...

**********************************************************************
* Calculating transfer functions for key 7D.M08A and range 2011.293-2012.200.
</pre></div>
</div>
<p>Note how the <code class="docutils literal notranslate"><span class="pre">DayNoise</span></code> objects are read randomly from disk, followed by the
<code class="docutils literal notranslate"><span class="pre">StaNoise</span></code> object. The result is a <code class="docutils literal notranslate"><span class="pre">TFNoise</span></code> object that is saved to a newly
created folder called <code class="docutils literal notranslate"><span class="pre">TF_STA/7D.M08A/</span></code>.</p>
<p>We can produce Figure 10 by re-running the previous command with the options
<code class="docutils literal notranslate"><span class="pre">-O</span> <span class="pre">--figTF</span></code>.</p>
<div class="figure align-center">
<img alt="_images/Figure_10.png" src="_images/Figure_10.png" />
</div>
<p>Figure 10: Transfer function amplitudes for the component combinations of interest,
as indicated in the title of each subplot. This example is for the month of March 2012
for station M08A. The daily transfer functions are shown in grey and the average
calculated for the whole month is shown in black.</p>
</div>
<div class="section" id="download-earthquake-data">
<h3>5. Download earthquake data<a class="headerlink" href="#download-earthquake-data" title="Permalink to this headline">¶</a></h3>
<p>Now we need to download the earthquake data, for which we wish to
clean the vertical component using the transfer functions just calculated.
This script <code class="docutils literal notranslate"><span class="pre">atacr_download_event.py</span></code> is very similar to <code class="docutils literal notranslate"><span class="pre">atacr_download_data.py</span></code>,
with the addition of the Event and Geometry Settings.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be careful with the Frequency Settings, as these values need to be exactly
the same as those used in <code class="docutils literal notranslate"><span class="pre">atacr_download_data.py</span></code>, but won’t be checked
against.</p>
</div>
<p>To download the seismograms that recorded the March 9, 2012, magnitude 6.6
Vanuatu earthquake (be conservative with the options), type in a terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ atacr_download_event.py --min-mag=6.3 --max-mag=6.7 --start=2012-03-08 --end=2012-03-10 M08A.pkl

Path to EVENTS/7D.M08A/ doesn`t exist - creating it

|===============================================|
|===============================================|
|                       M08A                    |
|===============================================|
|===============================================|
|  Station: 7D.M08A                             |
|      Channel: BH; Locations: --               |
|      Lon: -124.90; Lat:  44.12                |
|      Start time: 2011-10-20 00:00:00          |
|      End time:   2012-07-18 23:59:59          |
|-----------------------------------------------|
| Searching Possible events:                    |
|   Start: 2012-03-08 00:00:00                  |
|   End:   2012-03-10 00:00:00                  |
|   Mag:   6.3 - 6.7                            |
| ...                                           |
|  Found     1 possible events                  |

****************************************************
* #1 (2/1):  20120309_070953
*   Origin Time: 2012-03-09 07:09:53
*   Lat: -19.22; Lon:  169.75
*   Dep:  33.70; Mag: 6.6
*     M08A  -&gt; Ev: 9651.91 km;   86.80 deg; 239.43;  40.95

* Channels selected: [&#39;H&#39;, &#39;P&#39;] and vertical
*   2012.069.07.09
*   -&gt; Downloading Seismic data...
*      ...done
*   -&gt; Downloading Pressure data...
     ...done
*   -&gt; Removing responses - Seismic data
 WARNING: FIR normalized: sum[coef]=9.767192E-01;
 WARNING: FIR normalized: sum[coef]=9.767192E-01;
 WARNING: FIR normalized: sum[coef]=9.767192E-01;
*   -&gt; Removing responses - Pressure data
 WARNING: FIR normalized: sum[coef]=9.767192E-01;
</pre></div>
</div>
<p>The data are stored as an <code class="docutils literal notranslate"><span class="pre">EventStream</span></code> object, saved to disk in the
newly created folder <code class="docutils literal notranslate"><span class="pre">EVENTS/7D.M08A/</span></code>.</p>
</div>
<div class="section" id="correct-clean-earthquake-data">
<h3>6. Correct/clean earthquake data<a class="headerlink" href="#correct-clean-earthquake-data" title="Permalink to this headline">¶</a></h3>
<p>The final step in the analysis is the application of the transfer functions
to the raw earthquake seismograms to clean up the vertical component.
Once again, the default settings can be used. To make the final Figures 11 and 12,
specify the <code class="docutils literal notranslate"><span class="pre">--fig_Raw</span></code> and <code class="docutils literal notranslate"><span class="pre">--figClean</span></code> options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ atacr_correct_event.py --figRaw --figClean M08A.pkl


|===============================================|
|===============================================|
|                       M08A                    |
|===============================================|
|===============================================|
|  Station: 7D.M08A                             |
|      Channel: BH; Locations: --               |
|      Lon: -124.90; Lat:  44.12                |
|      Start time: 2011-10-20 00:00:00          |
|      End time:   2012-07-18 23:59:59          |
|-----------------------------------------------|
TF_STA/7D.M08A/2011.293-2012.200.transfunc.pkl file found - applying transfer functions
TF_STA/7D.M08A/2012.069.transfunc.pkl file found - applying transfer functions
</pre></div>
</div>
<p>Results are saved as <code class="docutils literal notranslate"><span class="pre">EventStream</span></code> objects that now contain the corrected
vertical components.</p>
<div class="figure align-center">
<img alt="_images/Figure_11.png" src="_images/Figure_11.png" />
</div>
<p>Figure 11: Event time series for the vertical (Z), horizontal 1 (H1), horizontal 2 (H2),
and pressure (P) components. No corrections have been applied. The data is for
station M08A for the Mw 6.6 earthquake that occurred near Vanuatu on March 9,
2012 and has been bandpass filtered from 10 - 150 s.</p>
<div class="figure align-center">
<img alt="_images/Figure_12a.png" src="_images/Figure_12a.png" />
</div>
<p>Figure 12a: Event time series for the vertical (Z) components after each of the transfer
functions of interest have been applied. The corrections are specified in the titles of
each subplot. The data is for station M08A for the Mw 6.6 earthquake that occurred
near Vanuatu on March 9, 2012 (same as Figure 11) and has been bandpass filtered
from 10 - 150 s. Traces in grey show the original (raw, un-corrected) vertical component.</p>
<div class="figure align-center">
<img alt="_images/Figure_12b.png" src="_images/Figure_12b.png" />
</div>
<p>Figure 12b: Same as Figure 12a but using the station averaged transfer functions. In this
case the <code class="docutils literal notranslate"><span class="pre">ZH</span></code> and <code class="docutils literal notranslate"><span class="pre">ZP-H</span></code> transfer functions are not available.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="obstools.html" class="btn btn-neutral float-left" title="Licence" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Pascal Audet, Helen Janiszewski

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>