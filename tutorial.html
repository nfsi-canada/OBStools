

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial &mdash; Home 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Home
          

          
            
            <img src="_static/obstools_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Quick Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="links.html">GitHub Repositories</a></li>
<li class="toctree-l1"><a class="reference internal" href="links.html#references">References</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="obstools.html">Licence</a></li>
<li class="toctree-l1"><a class="reference internal" href="obstools.html#installation">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="atacr.html">ATaCR</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Home</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial we will process and post-process receiver function data for station
MMPY. This will include calculating receiver functions using all default arguments,
re-calculating the receiver functions for different processing arguments, plotting
them, and post-processing them using the <cite>H-k</cite> stacking technique and applying
the harmonic decomposition method.</p>
<div class="section" id="creating-the-stdb-database">
<h2>0. Creating the <code class="docutils literal notranslate"><span class="pre">StDb</span></code> Database<a class="headerlink" href="#creating-the-stdb-database" title="Permalink to this headline">¶</a></h2>
<p>All the scripts provided require a <code class="docutils literal notranslate"><span class="pre">StDb</span></code> database containing station
information and metadata. Let’s first create this database for station
<cite>MMPY</cite> and send the prompt to a logfile</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ query_fdsn_stdb.py -N NY -S MMPY MMPY &gt; logfile
</pre></div>
</div>
<p>To check the station info for MMPY, use the program <code class="docutils literal notranslate"><span class="pre">ls_stdb.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls_stdb.py MMPY.pkl
Listing Station Pickle: MMPY.pkl
NY.MMPY
--------------------------------------------------------------------------
1) NY.MMPY
     Station: NY MMPY
      Alternate Networks: None
      Channel: HH ;  Location: --
      Lon, Lat, Elev:  62.61892, -131.26247,   0.000
      StartTime: 2013-07-01 00:00:00
      EndTime:   2020-10-26 15:28:46
      Status:    partial
      Polarity: 1
      Azimuth Correction: 0.000000
</pre></div>
</div>
</div>
<div class="section" id="download-and-process-receiver-functions">
<h2>1. Download and process receiver functions<a class="headerlink" href="#download-and-process-receiver-functions" title="Permalink to this headline">¶</a></h2>
<p>You can see above that the station MMPY has been in operation between July 2013
and October 2020 (Note: the date at which the tutorial was written). In theory,
we could run the main script to perform the automatic processing of the seismic
data (<code class="docutils literal notranslate"><span class="pre">rfpy_calc.py</span></code>) using for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_calc.py MMPY.pkl
</pre></div>
</div>
<p>However, in this example we would be looking at over seven years of data,
which is much more than we need for this tutorial. Note also that we didn’t specify
a station key, since there is only one station in the data base. By default,
<code class="docutils literal notranslate"><span class="pre">rfpy_calc.py</span></code> would process data for all teleseismic P-waves from earthquakes
with magnitudes between 6 and 9 and with epicentral distances between 30 and 90
degrees that occurred between July 2013 and October 2020. The default component
alignment is <code class="docutils literal notranslate"><span class="pre">ZRT</span></code> and the default deconvolution method is the <code class="docutils literal notranslate"><span class="pre">wiener</span></code> filter.</p>
<p>Let’s run an example where we want to limit the time range, include earthquakes
with magnitude down to 5.5, change the component alignment and the deconvolution method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_calc.py --minmag=5.5 --start=2017-05-01 --end=2017-10-31 --align=LQT --method=multitaper
</pre></div>
</div>
<p>An example log printed on the terminal will look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|===============================================|</span>
<span class="o">|===============================================|</span>
<span class="o">|</span>                       <span class="n">MMPY</span>                    <span class="o">|</span>
<span class="o">|===============================================|</span>
<span class="o">|===============================================|</span>
<span class="o">|</span>  <span class="n">Station</span><span class="p">:</span> <span class="n">NY</span><span class="o">.</span><span class="n">MMPY</span>                             <span class="o">|</span>
<span class="o">|</span>      <span class="n">Channel</span><span class="p">:</span> <span class="n">HH</span><span class="p">;</span> <span class="n">Locations</span><span class="p">:</span> <span class="o">--</span>               <span class="o">|</span>
<span class="o">|</span>      <span class="n">Lon</span><span class="p">:</span> <span class="o">-</span><span class="mf">131.26</span><span class="p">;</span> <span class="n">Lat</span><span class="p">:</span>  <span class="mf">62.62</span>                <span class="o">|</span>
<span class="o">|</span>      <span class="n">Start</span> <span class="n">time</span><span class="p">:</span> <span class="mi">2013</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>          <span class="o">|</span>
<span class="o">|</span>      <span class="n">End</span> <span class="n">time</span><span class="p">:</span>   <span class="mi">2020</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">26</span> <span class="mi">15</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">46</span>          <span class="o">|</span>
<span class="o">|-----------------------------------------------|</span>
<span class="o">|</span> <span class="n">Searching</span> <span class="n">Possible</span> <span class="n">events</span><span class="p">:</span>                    <span class="o">|</span>
<span class="o">|</span>   <span class="n">Start</span><span class="p">:</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                  <span class="o">|</span>
<span class="o">|</span>   <span class="n">End</span><span class="p">:</span>   <span class="mi">2017</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">31</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                  <span class="o">|</span>
<span class="o">|</span>   <span class="n">Mag</span><span class="p">:</span>   <span class="mf">5.5</span> <span class="o">-</span> <span class="mf">9.0</span>                            <span class="o">|</span>
<span class="o">|</span> <span class="o">...</span>                                           <span class="o">|</span>
<span class="o">|</span>  <span class="n">Found</span>   <span class="mi">179</span> <span class="n">possible</span> <span class="n">events</span>                  <span class="o">|</span>
<span class="o">|===============================================|</span>

<span class="o">**************************************************</span>
<span class="o">*</span> <span class="c1">#1 (5/179):  20170503_044713 NY.MMPY</span>
<span class="o">*</span> <span class="n">Requesting</span> <span class="n">Waveforms</span><span class="p">:</span>
<span class="o">*</span>    <span class="n">Startime</span><span class="p">:</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span> <span class="mi">04</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">33</span>
<span class="o">*</span>    <span class="n">Endtime</span><span class="p">:</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span> <span class="mi">05</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">33</span>
<span class="o">*</span>     <span class="n">MMPY</span><span class="o">.</span><span class="n">HH</span> <span class="o">-</span> <span class="n">ZNE</span><span class="p">:</span>
<span class="o">*</span>          <span class="n">HH</span><span class="p">[</span><span class="n">ZNE</span><span class="p">]</span><span class="o">.--</span> <span class="o">-</span> <span class="n">Checking</span> <span class="n">Network</span>
<span class="o">*</span>              <span class="o">-</span> <span class="n">ZNE</span> <span class="n">Data</span> <span class="n">Downloaded</span>
<span class="o">*</span> <span class="n">Start</span> <span class="n">times</span> <span class="n">are</span> <span class="ow">not</span> <span class="nb">all</span> <span class="n">close</span> <span class="n">to</span> <span class="n">true</span> <span class="n">start</span><span class="p">:</span>
<span class="o">*</span>   <span class="n">HHE</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span><span class="n">T04</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">33.230000</span><span class="n">Z</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span><span class="n">T05</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">34.220000</span><span class="n">Z</span>
<span class="o">*</span>   <span class="n">HHN</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span><span class="n">T04</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">33.230000</span><span class="n">Z</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span><span class="n">T05</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">34.220000</span><span class="n">Z</span>
<span class="o">*</span>   <span class="n">HHZ</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span><span class="n">T04</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">33.230000</span><span class="n">Z</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span><span class="n">T05</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">34.220000</span><span class="n">Z</span>
<span class="o">*</span>   <span class="kc">True</span> <span class="n">start</span><span class="p">:</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">03</span><span class="n">T04</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">33.229590</span><span class="n">Z</span>
<span class="o">*</span> <span class="o">-&gt;</span> <span class="n">Shifting</span> <span class="n">traces</span> <span class="n">to</span> <span class="n">true</span> <span class="n">start</span>
<span class="o">*</span> <span class="n">Waveforms</span> <span class="n">Retrieved</span><span class="o">...</span>
<span class="o">**************************************************</span>

<span class="o">...</span>
</pre></div>
</div>
<p>And so on until all data have been downloaded and processed. At that point you should
have a new folder named <code class="docutils literal notranslate"><span class="pre">P_DATA/NY.MMPY</span></code> containing all event folders, each of
them containing the meta data, station data, raw data, and receiver function data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls -R * | head

MMPY.csv
MMPY.pkl
P_DATA

./P_DATA:
NY.MMPY

./P_DATA/NY.MMPY:
20170503_044713
20170509_015414
</pre></div>
</div>
<p>Once this step is done, you can still re-calculate the receiver functions using
different processing options (see below). However, some parameters cannot be changed
easily without re-downloading the raw data (e.g., length of processing window,
sampling rate). If you want to change those parameters, run the previous command with
<code class="docutils literal notranslate"><span class="pre">-O</span></code> to override anything that exists on disk.</p>
<p>Note that you can get more data by either specifying a new phase to analyze (e.g., <code class="docutils literal notranslate"><span class="pre">--phase=PP</span></code>), going to lower magnitudes (e.g., <code class="docutils literal notranslate"><span class="pre">--minmag=5.</span> <span class="pre">--maxmag=5.5</span></code>), by
running the same line of command with those additional arguments.</p>
</div>
<div class="section" id="re-calculate-with-different-options">
<h2>2. Re-calculate with different options<a class="headerlink" href="#re-calculate-with-different-options" title="Permalink to this headline">¶</a></h2>
<p>If later on you decide you want to try a different deconvolution method, component
alignment or maybe try some pre-filtering options, you can always simply use the
<code class="docutils literal notranslate"><span class="pre">rfpy_recalc.py</span></code> script to do so.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Re-calculating the receiver functions for different options will override any
existing receiver function data. Be mindful of this when using this script.</p>
</div>
<p>This can be done by typing in the terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_recalc.py --align=ZRT --method=wiener MMPY.pkl
</pre></div>
</div>
</div>
<div class="section" id="plot-receiver-functions-by-back-azimuth-or-slowness">
<h2>3. Plot receiver functions by back-azimuth or slowness<a class="headerlink" href="#plot-receiver-functions-by-back-azimuth-or-slowness" title="Permalink to this headline">¶</a></h2>
<p>Now that we have our data set of receiver functions, we can plot it! There are two
types of plots: the Back-azimuth panels and the Slowness panels. In the first case
the receiver functions are sorted by back-azimuth and all slowness information is
lost (i.e., averaged out). In the same case it is the opposite and the receiver
fuuntions are sorted by slowness and all back-azimuth information is lost. When
plotting, you can decide whether to include all data, or set some quality control
thresholds based on 1) SNR of vertical component, 2) CC value of predicted and
observed radial components, and 3) outliers. If you don’t specify any thresholding,
by default the script <code class="docutils literal notranslate"><span class="pre">rfpy_plot.py</span></code> will use all data in the plots. You also want
to set corner frequencies for filterig, otherwise it will be difficult to see
anything. Typically you would choose a bandwidth that encompasses the dominant
frequencies of teleseismic P waves (i.e., 0.05 to 1 Hz). Let’s examine
the two types of plots with examples:</p>
<div class="section" id="back-azimuth-panel">
<h3>Back-azimuth panel<a class="headerlink" href="#back-azimuth-panel" title="Permalink to this headline">¶</a></h3>
<p>Below we make a plot of all P receiver functions, filtered between 0.05 and 0.5 Hz,
using 36 back-azimuth bins. We plot the RFs from -2. to +30 seconds following the
zero-lag (i.e., P-wave arrival) time, stack all traces to produce an averaged RF,
and normalize all traces to that of the stacks.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_plot.py --no-outlier --bp=0.05,0.5 --nbaz=36 --normalize --trange=-2.,30. MMPY.pkl
</pre></div>
</div>
<div class="figure align-center">
<img alt="../rfpy/examples/figures/Figure_1.png" src="../rfpy/examples/figures/Figure_1.png" />
</div>
</div>
<div class="section" id="slowness-panel">
<h3>Slowness panel<a class="headerlink" href="#slowness-panel" title="Permalink to this headline">¶</a></h3>
<p>Now let’s make a plot of all P receiver functions, this time sorted by slowness using
20 bins. Instead</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_plot.py --no-outlier --bp=0.05,0.5 --nslow=20 --normalize --trange=-2.,30. MMPY.pkl
</pre></div>
</div>
<div class="figure align-center">
<img alt="../rfpy/examples/figures/Figure_1.png" src="../rfpy/examples/figures/Figure_1.png" />
</div>
</div>
</div>
<div class="section" id="moho-depth-and-vp-vs-from-h-k-stacking">
<h2>4. Moho depth and Vp/Vs from <code class="docutils literal notranslate"><span class="pre">H-k</span></code> stacking<a class="headerlink" href="#moho-depth-and-vp-vs-from-h-k-stacking" title="Permalink to this headline">¶</a></h2>
<p>With these receiver functions, we can easily estimate Moho depth and crustal Vp/Vs
using the simple H-k stacking method. There are several options to choose from. Let’s
examine the default options.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_hk.py MMPY.pkl
</pre></div>
</div>
<p>By default the script will use all available receiver functions (no thresholding), bin
them using 36 back-azimuth and 40 slowness bins, and stack them using H and k intervals
of 0.5 and 0.02, respectively, with bounds of [20., 50] and [1.56, 2.1], respectively
for H and k search. The weights for the Ps, Pps and Pss phases is [0.5, 2., -1] and
the final H-k stack will be the weighted sum of all 3 phases. The default crustal Vp
value to use in calculating the phase arrival time is 6.0 km/s. Finally, after
computing the stacks, nothing is done and the code stops. To produce a plot and save
the results to disk requires adding processing arguments.</p>
<p>As an example, let’s remove outliers, using 20 slowness bins (instead of 40 to speed
things up), change the weights to [1., 1., 0], change the Vp to 5.5 km/s, save the
H-k object and make a plot with some title:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_hk.py --no-outlier --nslow=20 --weights=1.,1.,0. --vp=5.5 --save --plot --title=&#39;First attempt&#39; MMPY.pkl

#########################################
#        __                 _     _     #
#  _ __ / _|_ __  _   _    | |__ | | __ #
# | &#39;__| |_| &#39;_ \| | | |   | &#39;_ \| |/ / #
# | |  |  _| |_) | |_| |   | | | |   &lt;  #
# |_|  |_| | .__/ \__, |___|_| |_|_|\_\ #
#          |_|    |___/_____|           #
#                                       #
#########################################

Path to HK_DATA/NY.MMPY doesn`t exist - creating it


|===============================================|
|===============================================|
|                       MMPY                    |
|===============================================|
|===============================================|
|  Station: NY.MMPY                             |
|      Channel: HH; Locations: --               |
|      Lon: -131.26; Lat:  62.62                |
|      Start time: 2013-07-01 00:00:00          |
|      End time:   2020-10-26 15:28:46          |
|-----------------------------------------------|

Number of radial RF data: 90


Number of radial RF bins: 16

Computing: [#####..........] 24/61
</pre></div>
</div>
<p>Once computing is done (when it reaches 61/61), the script will produce the following
figure:</p>
<div class="figure align-center">
<img alt="../rfpy/examples/figures/Figure_3.png" src="../rfpy/examples/figures/Figure_3.png" />
</div>
<p>Alternatively, we can compute the stacks using the product of all phase stacks, which
gets rid of the subjective choice of weights. Let’s re-do the prevous example with a
number of changes: 1) use a copy of the RFs to use for the reverberations (Pps and
Pss), 2) bandpass filter those at lower high-frequency corner, and 3) select the
‘product’ method.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rfpy_hk.py --no-outlier --nslow=20 --vp=5.5 --copy --bp-copy=0.05,0.35 --type=product --save --plot --title=&#39;Second attempt&#39; MMPY.pkl
</pre></div>
</div>
<p>The new figure is slightly different (there is no negative amplitude) but produces
much cleaner H and k estimates. Note that the labeled weights above each panel
correspond to the default values but are not used in the final stack.</p>
<div class="figure align-center">
<img alt="../rfpy/examples/figures/Figure_4.png" src="../rfpy/examples/figures/Figure_4.png" />
</div>
<p>Finally, could also perform H-k stacking using a known orientation (strike and dip
angles) of a dipping interface using additional arguments.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Pascal Audet, Helen Janiszewski

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>